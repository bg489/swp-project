(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9901],{1693:(e,s,t)=>{Promise.resolve().then(t.bind(t,6242))},4186:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(9946).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},6242:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>w});var a=t(5155),r=t(2115),n=t(8482),l=t(8145),c=t(7949),i=t(7746),d=t(8074),h=t(9397);let m=(0,t(9946).A)("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);var x=t(7434),o=t(9074),u=t(4416),g=t(8691),j=t(4186),p=t(4516),y=t(3403),v=t(395),N=t(6350),f=t(5784),b=t(7168);function w(){let{user:e,isLoading:s}=(0,v.A)(),[t,w]=(0,r.useState)([]),[_,k]=(0,r.useState)(!0),[A,T]=(0,r.useState)("newest"),[H,M]=(0,r.useState)(null);if((0,r.useEffect)(()=>{(async function(){if(!(null==e?void 0:e._id)){console.log("User or user._id is missing:",e),k(!1);return}console.log("Current user object:",{id:e._id,role:e.role,email:e.email,full_name:e.full_name});try{console.log("Fetching donor requests for user ID:",e._id),k(!0);let s=await y.A.get("/users/donor/get-requests-by-id/".concat(e._id));console.log("API Response:",s.data),w(s.data.requests||[])}catch(e){var s,t,a;console.error("Error fetching donor requests:",e),console.error("Error details:",null===(s=e.response)||void 0===s?void 0:s.data),(null===(t=e.response)||void 0===t?void 0:t.status)===404?console.error("User not found or not a valid donor"):(null===(a=e.response)||void 0===a?void 0:a.status)===500&&console.error("Server error occurred"),w([])}finally{k(!1)}})()},[e]),s)return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-pink-50 to-rose-100 flex flex-col",children:[(0,a.jsx)(c.Header,{}),(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-500 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Đang tải..."})]})}),(0,a.jsx)(i.Footer,{})]});if(!e)return(0,a.jsx)(N.z,{});if("donor"!==e.role)return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-pink-50 to-rose-100 flex flex-col",children:[(0,a.jsx)(c.Header,{}),(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center p-4",children:(0,a.jsx)(n.Zp,{className:"w-full max-w-md",children:(0,a.jsxs)(n.aR,{className:"text-center",children:[(0,a.jsx)(n.ZB,{className:"text-red-600",children:"Kh\xf4ng c\xf3 quyền truy cập"}),(0,a.jsx)(n.BT,{children:"Trang n\xe0y chỉ d\xe0nh cho người hiến m\xe1u. Bạn cần đăng k\xfd l\xe0 người hiến m\xe1u để xem lịch sử y\xeau cầu."})]})})}),(0,a.jsx)(i.Footer,{})]});let q=async s=>{if(window.confirm("Bạn c\xf3 chắc chắn muốn hủy y\xeau cầu hiến m\xe1u n\xe0y?"))try{M(s),await y.A.put("/users/donor/cancel-request/".concat(s),{donorId:null==e?void 0:e._id}),w(e=>e.map(e=>e._id===s?{...e,status:"cancelled"}:e)),alert("Đ\xe3 hủy y\xeau cầu hiến m\xe1u th\xe0nh c\xf4ng!")}catch(e){var t,a;console.error("Error cancelling request:",e),alert((null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"Đ\xe3 xảy ra lỗi khi hủy y\xeau cầu.")}finally{M(null)}},C=[...t].sort((e,s)=>{switch(A){case"newest":default:return new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime();case"oldest":return new Date(e.createdAt).getTime()-new Date(s.createdAt).getTime();case"status":let t=["pending","in_progress","approved","matched","completed","cancelled","rejected"],a=t.indexOf(e.status),r=t.indexOf(s.status);return(-1===a?t.length:a)-(-1===r?t.length:r)}}),D=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"pending":case"in_progress":return"bg-yellow-100 text-yellow-800";case"cancelled":case"rejected":return"bg-red-100 text-red-800";case"approved":case"matched":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},E=e=>{try{return new Date(e).toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric",weekday:"long"})}catch(e){return"Ng\xe0y kh\xf4ng hợp lệ"}},Z=e=>e||"Kh\xf4ng x\xe1c định",B=e=>{try{let s=new Date(e),t=new Date,a=Math.abs(t.getTime()-s.getTime()),r=Math.ceil(a/864e5);if(1===r)return"H\xf4m qua";if(r<=7)return"".concat(r," ng\xe0y trước");return s.toLocaleDateString("vi-VN",{year:"numeric",month:"short",day:"numeric"})}catch(e){return"Ng\xe0y kh\xf4ng hợp lệ"}};return(0,a.jsx)(d.O,{requiredRole:"donor",children:(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-red-50 to-white",children:[(0,a.jsx)(c.Header,{}),_?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"})}):(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(h.A,{className:"w-8 h-8 text-white"})}),(0,a.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Lịch sử y\xeau cầu hiến m\xe1u"}),(0,a.jsx)("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Theo d\xf5i tất cả c\xe1c y\xeau cầu hiến m\xe1u bạn đ\xe3 gửi"})]}),(0,a.jsx)("div",{className:"flex justify-end items-center mb-8",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(m,{className:"w-4 h-4 text-gray-500"}),(0,a.jsxs)(f.l6,{value:A,onValueChange:e=>T(e),children:[(0,a.jsx)(f.bq,{className:"w-[180px]",children:(0,a.jsx)(f.yv,{placeholder:"Sắp xếp theo"})}),(0,a.jsxs)(f.gC,{children:[(0,a.jsx)(f.eb,{value:"newest",children:"Mới nhất"}),(0,a.jsx)(f.eb,{value:"oldest",children:"Cũ nhất"}),(0,a.jsx)(f.eb,{value:"status",children:"Theo trạng th\xe1i"})]})]})]})}),(0,a.jsxs)("div",{className:"grid md:grid-cols-4 gap-4 mb-8",children:[(0,a.jsx)(n.Zp,{children:(0,a.jsxs)(n.Wu,{className:"p-6 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:C.length}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Tổng y\xeau cầu"})]})}),(0,a.jsx)(n.Zp,{children:(0,a.jsxs)(n.Wu,{className:"p-6 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:C.filter(e=>"completed"===e.status).length}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Ho\xe0n tất"})]})}),(0,a.jsx)(n.Zp,{children:(0,a.jsxs)(n.Wu,{className:"p-6 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:C.filter(e=>"in_progress"===e.status||"pending"===e.status).length}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Đang xử l\xfd"})]})}),(0,a.jsx)(n.Zp,{children:(0,a.jsxs)(n.Wu,{className:"p-6 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600",children:C.filter(e=>"cancelled"===e.status||"rejected"===e.status).length}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Đ\xe3 hủy/Từ chối"})]})})]}),0===C.length?(0,a.jsx)(n.Zp,{children:(0,a.jsxs)(n.Wu,{className:"p-12 text-center",children:[(0,a.jsx)(x.A,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Chưa c\xf3 y\xeau cầu hiến m\xe1u"}),(0,a.jsx)("p",{className:"text-gray-500",children:"Bạn chưa gửi y\xeau cầu hiến m\xe1u n\xe0o. H\xe3y đăng k\xfd hiến m\xe1u để cứu sống những người cần gi\xfap đỡ."})]})}):(0,a.jsx)("div",{className:"space-y-6",children:C.map((e,s)=>{var t,r,c;return(0,a.jsxs)(n.Zp,{className:"overflow-hidden",children:[(0,a.jsx)(n.aR,{className:"pb-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(n.ZB,{className:"text-lg",children:"Y\xeau cầu hiến m\xe1u"}),(0,a.jsxs)(n.BT,{className:"flex items-center mt-1",children:[(0,a.jsx)(o.A,{className:"w-4 h-4 mr-1"}),"Đăng k\xfd: ",B(e.createdAt)]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(l.E,{className:D(e.status),children:{pending:"Đang xử l\xfd",approved:"Đ\xe3 duyệt",matched:"Đ\xe3 gh\xe9p",in_progress:"Đang xử l\xfd",completed:"Ho\xe0n tất",cancelled:"Đ\xe3 hủy",rejected:"Từ chối"}[c=e.status]||c}),("pending"===e.status||"in_progress"===e.status)&&(0,a.jsx)(b.$,{variant:"outline",size:"sm",onClick:()=>q(e._id),disabled:H===e._id,className:"text-red-600 border-red-200 hover:bg-red-50 disabled:opacity-50",children:H===e._id?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-red-600 mr-1"}),"Đang hủy..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.A,{className:"w-4 h-4 mr-1"}),"Hủy y\xeau cầu"]})})]})]})}),(0,a.jsxs)(n.Wu,{children:[(0,a.jsxs)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h4",{className:"font-medium text-gray-900 flex items-center",children:[(0,a.jsx)(g.A,{className:"w-4 h-4 mr-2 text-red-500"}),"Th\xf4ng tin hiến m\xe1u"]}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Nh\xf3m m\xe1u:"}),(0,a.jsx)(l.E,{variant:"outline",className:"ml-2",children:e.blood_type_offered})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Số lượng:"}),(0,a.jsxs)("span",{className:"ml-2 font-medium",children:[e.amount_offered,"ml"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Th\xe0nh phần:"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:e.components_offered.map((e,s)=>(0,a.jsx)(l.E,{variant:"secondary",className:"text-xs",children:{whole:"M\xe1u to\xe0n phần",RBC:"Hồng cầu",plasma:"Huyết tương",platelet:"Tiểu cầu"}[e]||e},s))})]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h4",{className:"font-medium text-gray-900 flex items-center",children:[(0,a.jsx)(j.A,{className:"w-4 h-4 mr-2 text-blue-500"}),"Thời gian"]}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Ng\xe0y hiến:"}),(0,a.jsx)("span",{className:"ml-2 font-medium",children:E(e.available_date)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Giờ:"}),(0,a.jsxs)("span",{className:"ml-2 font-medium",children:[Z(e.available_time_range.from)," - ",Z(e.available_time_range.to)]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h4",{className:"font-medium text-gray-900 flex items-center",children:[(0,a.jsx)(p.A,{className:"w-4 h-4 mr-2 text-green-500"}),"Bệnh viện"]}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"T\xean:"}),(0,a.jsx)("span",{className:"ml-2 font-medium",children:(null===(t=e.hospital)||void 0===t?void 0:t.name)||"Đang cập nhật"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Địa chỉ:"}),(0,a.jsx)("span",{className:"ml-2 text-gray-700",children:(null===(r=e.hospital)||void 0===r?void 0:r.address)||"Đang cập nhật"})]})]})]})]}),e.comment&&(0,a.jsxs)("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Ghi ch\xfa:"}),(0,a.jsx)("p",{className:"text-sm text-gray-700",children:e.comment})]})]})]},e._id)})})]})}),(0,a.jsx)(i.Footer,{})]})})}},7434:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(9946).A)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},9074:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(9946).A)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},9397:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(9946).A)("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]])}},e=>{var s=s=>e(e.s=s);e.O(0,[6237,6222,3464,461,1975,7949,8337,8441,1684,7358],()=>s(1693)),_N_E=e.O()}]);