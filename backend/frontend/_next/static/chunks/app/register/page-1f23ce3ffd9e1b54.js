(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2454],{1851:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>S});var t=s(5155),l=s(2115),r=s(7168),n=s(8482),i=s(9852),d=s(2714),c=s(5784),o=s(3695),h=s(9026),m=s(5339),u=s(1007),g=s(1264),p=s(2919),x=s(8749),v=s(2657),j=s(9420),y=s(8691),N=s(9074),f=s(4516),b=s(646),w=s(6874),k=s.n(w),A=s(5695),_=s(7949),C=s(7746),M=s(3403),T=s(3852),F=s(3568);function S(){let[e,a]=(0,l.useState)({name:"",email:"",password:"",confirmPassword:"",phone:"",address:"",bloodType:"",gender:"",date_of_birth:"",role:"",date_begin_donate:"",certificate:"",hospital_name:"",hospitalId:"",agreeTerms:!1}),[s,w]=(0,l.useState)(!1),[S,q]=(0,l.useState)(!1),[D,P]=(0,l.useState)(""),[I,J]=(0,l.useState)(!1),[V,B]=(0,l.useState)(!1),[E,L]=(0,l.useState)(""),[O,K]=(0,l.useState)(""),[z,R]=(0,l.useState)(!0),[H,Y]=(0,l.useState)(-1),[$,Z]=(0,l.useState)([]),[G,Q]=(0,l.useState)(null),[U,W]=(0,l.useState)(10),[X,ee]=(0,l.useState)(null),ea=(0,A.useRouter)(),es=()=>{if(!navigator.geolocation){F.Ay.error("Tr\xecnh duyệt kh\xf4ng hỗ trợ định vị!"),Q(!1);return}navigator.geolocation.getCurrentPosition(e=>{Q(!0),F.Ay.success("✅ Đ\xe3 cho ph\xe9p định vị!")},e=>{console.error("Từ chối định vị:",e),Q(!1),F.Ay.error("❌ Bạn đ\xe3 từ chối quyền định vị, t\xednh năng t\xecm kiếm sẽ bị kho\xe1.")})};(0,l.useEffect)(()=>{navigator.geolocation.getCurrentPosition(async e=>{let{latitude:a,longitude:s}=e.coords;ee({lat:a,lng:s});try{let e=(await M.A.get("/hospital/")).data.hospitals,t=(e,a,s,t)=>{let l=(s-e)*Math.PI/180,r=(t-a)*Math.PI/180,n=Math.sin(l/2)**2+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(r/2)**2,i=2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n));return 6371*i},l=e.filter(e=>30>=t(a,s,e.latitude,e.longitude)).map(e=>({_id:e._id,name:e.name,address:e.address,phone:e.phone}));Z(l)}catch(e){console.error("Lỗi khi lấy danh s\xe1ch bệnh viện:",e)}},e=>{console.error("Lỗi lấy vị tr\xed:",e),alert("Kh\xf4ng thể lấy vị tr\xed của bạn. Vui l\xf2ng bật định vị.")})},[]),(0,l.useEffect)(()=>{es()},[]);let et=e=>{a(a=>({...a,hospitalId:e._id})),L(e.name),K(e.name),R(!1),Y(-1)},el=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/đ/g,"d").replace(/Đ/g,"D"),er=$.filter(e=>el(e.name.toLowerCase()).includes(el(O.toLowerCase()))),en=async a=>{if(a.preventDefault(),q(!0),P(""),e.password!==e.confirmPassword){P("Mật khẩu x\xe1c nhận kh\xf4ng khớp"),q(!1);return}if(!e.agreeTerms){P("Vui l\xf2ng đồng \xfd với điều khoản sử dụng"),q(!1);return}if(e.password.length<6){P("Mật khẩu phải c\xf3 \xedt nhất 6 k\xfd tự"),q(!1);return}try{var s;let a=await M.A.get("users/get-all-emails"),t=e.email.toLowerCase();if((null===(s=a.data)||void 0===s?void 0:s.emails.map(e=>e.toLowerCase())).includes(t)){P("Email đ\xe3 tồn tại.");return}let l=await M.A.post("/users/register",{full_name:e.name,email:e.email,password:e.password,role:e.role,phone:e.phone,gender:e.gender,date_of_birth:e.date_of_birth,address:e.address}),r=await l.data;r.message?("donor"===e.role?(await M.A.put("/users/".concat(r.user.id,"/role"),{newRole:"donor"}),await M.A.post("/users/donor-profile",{user_id:r.user.id,blood_type:e.bloodType,availability_date:e.date_begin_donate,health_cert_url:e.certificate,cooldown_until:"",hospital:e.hospitalId})):(await M.A.put("/users/".concat(r.user.id,"/role"),{newRole:"recipient"}),await M.A.post("/users/recipient-profile",{user_id:r.user.id,medical_doc_url:e.certificate,hospital:e.hospitalId})),M.A.post("/otp/send",{email:e.email}),ea.push("/register/otp?email=".concat(e.email))):P(r.message)}catch(e){P("Đ\xe3 xảy ra lỗi. Vui l\xf2ng thử lại.")}finally{q(!1)}};return(0,t.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-red-50 to-white flex flex-col",children:[(0,t.jsx)(_.Header,{}),(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center p-4 py-8",children:(0,t.jsx)("div",{className:"w-full max-w-2xl",children:(0,t.jsxs)(n.Zp,{className:"w-full shadow-lg",children:[(0,t.jsxs)(n.aR,{className:"text-center space-y-2",children:[(0,t.jsx)(n.ZB,{className:"text-2xl font-bold",children:"Đăng k\xfd t\xe0i khoản"}),(0,t.jsx)(n.BT,{children:"Tạo t\xe0i khoản để tham gia cộng đồng hiến m\xe1u"})]}),(0,t.jsxs)(n.Wu,{children:[(0,t.jsxs)("form",{onSubmit:en,className:"space-y-4",children:[D&&(0,t.jsxs)(h.Fc,{variant:"destructive",children:[(0,t.jsx)(m.A,{className:"h-4 w-4"}),(0,t.jsx)(h.TN,{children:D})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{htmlFor:"name",children:"Họ v\xe0 t\xean *"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(u.A,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,t.jsx)(i.p,{id:"name",placeholder:"Nguyễn Văn A",value:e.name,onChange:e=>a(a=>({...a,name:e.target.value})),className:"pl-10",required:!0})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{htmlFor:"email",children:"Email *"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(g.A,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,t.jsx)(i.p,{id:"email",type:"email",placeholder:"email@example.com",value:e.email,onChange:e=>a(a=>({...a,email:e.target.value})),className:"pl-10",required:!0})]})]})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{htmlFor:"password",children:"Mật khẩu *"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(p.A,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,t.jsx)(i.p,{id:"password",type:I?"text":"password",placeholder:"••••••••",value:e.password,onChange:e=>a(a=>({...a,password:e.target.value})),className:"pl-10 pr-10",required:!0}),(0,t.jsx)("button",{type:"button",onClick:()=>J(!I),className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600",children:I?(0,t.jsx)(x.A,{className:"h-4 w-4"}):(0,t.jsx)(v.A,{className:"h-4 w-4"})})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{htmlFor:"confirmPassword",children:"X\xe1c nhận mật khẩu *"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(p.A,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,t.jsx)(i.p,{id:"confirmPassword",type:V?"text":"password",placeholder:"••••••••",value:e.confirmPassword,onChange:e=>a(a=>({...a,confirmPassword:e.target.value})),className:"pl-10 pr-10",required:!0}),(0,t.jsx)("button",{type:"button",onClick:()=>B(!V),className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600",children:V?(0,t.jsx)(x.A,{className:"h-4 w-4"}):(0,t.jsx)(v.A,{className:"h-4 w-4"})})]})]})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{htmlFor:"phone",children:"Số điện thoại *"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(j.A,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,t.jsx)(i.p,{id:"phone",type:"tel",placeholder:"0901234567",value:e.phone,onChange:e=>a(a=>({...a,phone:e.target.value})),className:"pl-10",required:!0})]})]}),"donor"===e.role&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{htmlFor:"bloodType",children:"Nh\xf3m m\xe1u *"}),(0,t.jsxs)(c.l6,{value:e.bloodType,onValueChange:e=>a(a=>({...a,bloodType:e})),children:[(0,t.jsx)(c.bq,{children:(0,t.jsx)(c.yv,{placeholder:"Chọn nh\xf3m m\xe1u"})}),(0,t.jsxs)(c.gC,{children:[(0,t.jsx)(c.eb,{value:"unknown",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(y.A,{className:"w-4 h-4 mr-2 text-red-500"}),"Chưa biết"]})},"unknown"),["O-","O+","A-","A+","B-","B+","AB-","AB+"].map(e=>(0,t.jsx)(c.eb,{value:e,children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(y.A,{className:"w-4 h-4 mr-2 text-red-500"}),e]})},e))]})]})]})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{htmlFor:"role",children:"Vai tr\xf2 *"}),(0,t.jsxs)(c.l6,{value:e.role,onValueChange:e=>a(a=>({...a,role:e})),children:[(0,t.jsx)(c.bq,{children:(0,t.jsx)(c.yv,{placeholder:"Chọn vai tr\xf2"})}),(0,t.jsxs)(c.gC,{children:[(0,t.jsx)(c.eb,{value:"donor",children:"Người hiến m\xe1u (Donor)"}),(0,t.jsx)(c.eb,{value:"recipient",children:"Người nhận m\xe1u (Recipient)"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{htmlFor:"gender",children:"Giới t\xednh *"}),(0,t.jsxs)(c.l6,{value:e.gender,onValueChange:e=>a(a=>({...a,gender:e})),children:[(0,t.jsx)(c.bq,{children:(0,t.jsx)(c.yv,{placeholder:"Chọn giới t\xednh"})}),(0,t.jsx)(c.gC,{children:["male","female","other"].map(e=>(0,t.jsx)(c.eb,{value:e,children:(0,t.jsx)("div",{className:"flex items-center capitalize",children:"male"===e?"Nam":"female"===e?"Nữ":"Kh\xe1c"})},e))})]})]})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{htmlFor:"dob",children:"Ng\xe0y sinh (18-60 tuổi) *"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(N.A,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,t.jsx)(i.p,{id:"dob",type:"date",value:e.date_of_birth,onChange:e=>a(a=>({...a,date_of_birth:e.target.value})),className:"pl-10",min:new Date(new Date().setFullYear(new Date().getFullYear()-60)).toISOString().split("T")[0],max:new Date(new Date().setFullYear(new Date().getFullYear()-18)).toISOString().split("T")[0],required:!0})]})]}),(0,t.jsx)("div",{className:"space-y-2"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{htmlFor:"address",children:"Địa chỉ *"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(f.A,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,t.jsx)(i.p,{id:"address",placeholder:"123 Đường ABC, Quận 1, TP.HCM",value:e.address,onChange:e=>a(a=>({...a,address:e.target.value})),className:"pl-10",required:!0})]})]}),("donor"===e.role||"recipient"===e.role)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:["donor"===e.role&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{htmlFor:"dbd",children:"Ng\xe0y bắt đầu hiến m\xe1u *"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(N.A,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,t.jsx)(i.p,{id:"dbd",type:"date",value:e.date_begin_donate,onChange:e=>a(a=>({...a,date_begin_donate:e.target.value})),className:"pl-10",min:new Date().toISOString().split("T")[0],required:!0})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{htmlFor:"hospital_name",children:"T\xean bệnh viện *"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(f.A,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,t.jsx)(i.p,{id:"hospital_name",placeholder:"ex: Bệnh viện H\xf9ng Vương",value:E,onChange:e=>{K(e.target.value),L(e.target.value),R(!0),Y(-1)},onKeyDown:e=>{if(z){if("ArrowDown"===e.key){let a=(H+1)%er.length;Y(a),L(er[a].name),e.preventDefault()}else if("ArrowUp"===e.key){let a=(H-1+er.length)%er.length;Y(a),L(er[a].name),e.preventDefault()}else"Enter"===e.key&&H>=0&&(et(er[H]),e.preventDefault())}},className:"pl-10",required:!0,disabled:!1===G}),z&&er.length>0&&(0,t.jsx)("ul",{className:"absolute z-10 bg-white border border-gray-300 w-full max-h-60 overflow-y-auto shadow-lg rounded",children:er.map((e,a)=>(0,t.jsxs)("li",{ref:H===a?e=>null==e?void 0:e.scrollIntoView({block:"nearest"}):null,className:"px-4 py-2 hover:bg-gray-100 cursor-pointer ".concat(H===a?"bg-gray-200":""),onClick:()=>et(e),children:[(0,t.jsx)("strong",{children:e.name}),e.address&&(0,t.jsx)("div",{className:"text-sm text-gray-500",children:e.address})]},a))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{htmlFor:"certificateDonor",children:"Ảnh giấy chứng nhận sức khỏe *"}),(0,t.jsx)(T.A,{id:"certificateDonor",value:e.certificate,onChange:e=>a(a=>({...a,certificate:e}))})]})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,t.jsx)("div",{className:"space-y-2"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{htmlFor:"radiusKm",children:"Khoảng c\xe1ch t\xecm bệnh viện (km) *"}),(0,t.jsx)(i.p,{id:"radiusKm",type:"number",placeholder:"VD: 30",value:U,onChange:e=>W(Number(e.target.value)),required:!0,disabled:!1===G}),(0,t.jsx)(r.$,{type:"button",onClick:()=>{if(!navigator.geolocation){F.Ay.error("Tr\xecnh duyệt kh\xf4ng hỗ trợ định vị!");return}navigator.geolocation.getCurrentPosition(async e=>{let{latitude:a,longitude:s}=e.coords;try{let e=(await M.A.get("/hospital/")).data.hospitals,t=(e,a,s,t)=>{let l=(s-e)*Math.PI/180,r=(t-a)*Math.PI/180,n=Math.sin(l/2)**2+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(r/2)**2,i=2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n));return 6371*i},l=e.filter(e=>t(a,s,e.latitude,e.longitude)<=U).map(e=>({_id:e._id,name:e.name,address:e.address,phone:e.phone}));Z(l),l.length>0?F.Ay.success("✅ T\xecm thấy ".concat(l.length," bệnh viện trong ").concat(U," km!")):F.Ay.error("❌ Kh\xf4ng t\xecm thấy bệnh viện n\xe0o trong ".concat(U," km."))}catch(e){console.error("Lỗi lấy danh s\xe1ch bệnh viện:",e),F.Ay.error("Đ\xe3 xảy ra lỗi khi t\xecm bệnh viện!")}},e=>{console.error("Người d\xf9ng từ chối chia sẻ vị tr\xed:",e),F.Ay.error("❌ Bạn đ\xe3 từ chối chia sẻ vị tr\xed, kh\xf4ng thể t\xecm kiếm bệnh viện gần bạn.")})},className:"w-full",disabled:!1===G,children:"T\xecm bệnh viện gần bạn"})]})]})]}),(0,t.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,t.jsx)(o.S,{id:"agreeTerms",checked:e.agreeTerms,onCheckedChange:e=>a(a=>({...a,agreeTerms:e})),required:!0}),(0,t.jsxs)(d.J,{htmlFor:"agreeTerms",className:"text-sm leading-5",children:["T\xf4i đồng \xfd với"," ",(0,t.jsx)(k(),{href:"/terms",className:"text-red-600 hover:underline",children:"điều khoản sử dụng"})," ","v\xe0"," ",(0,t.jsx)(k(),{href:"/privacy",className:"text-red-600 hover:underline",children:"ch\xednh s\xe1ch bảo mật"}),". T\xf4i cam kết th\xf4ng tin cung cấp l\xe0 ch\xednh x\xe1c v\xe0 đồng \xfd tham gia hiến m\xe1u t\xecnh nguyện."]})]}),(0,t.jsx)(r.$,{type:"submit",className:"w-full",disabled:S,children:S?(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Đang đăng k\xfd..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.A,{className:"w-4 h-4 mr-2"}),"Đăng k\xfd t\xe0i khoản"]})})]}),(0,t.jsx)("div",{className:"text-center mt-6",children:(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["Đ\xe3 c\xf3 t\xe0i khoản?"," ",(0,t.jsx)(k(),{href:"/login",className:"text-red-600 hover:underline font-medium",children:"Đăng nhập ngay"})]})})]})]})})}),(0,t.jsx)(F.l$,{position:"top-center",containerStyle:{top:80}}),(0,t.jsx)(C.Footer,{})]})}},2657:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(9946).A)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},2825:(e,a,s)=>{Promise.resolve().then(s.bind(s,1851))},2919:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(9946).A)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},8749:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(9946).A)("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]])}},e=>{var a=a=>e(e.s=a);e.O(0,[6237,6222,3464,3568,461,1975,7949,6555,8441,1684,7358],()=>a(2825)),_N_E=e.O()}]);