(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1192],{446:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(9946).A)("Droplet",[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]])},556:(e,t,s)=>{Promise.resolve().then(s.bind(s,8256))},646:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(9946).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},704:(e,t,s)=>{"use strict";s.d(t,{B8:()=>D,UC:()=>S,bL:()=>q,l9:()=>R});var a=s(2115),n=s(5185),l=s(6081),r=s(9196),i=s(8905),o=s(3655),d=s(4315),c=s(5845),u=s(1285),h=s(5155),m="Tabs",[x,p]=(0,l.A)(m,[r.RG]),f=(0,r.RG)(),[g,v]=x(m),y=a.forwardRef((e,t)=>{let{__scopeTabs:s,value:a,onValueChange:n,defaultValue:l,orientation:r="horizontal",dir:i,activationMode:m="automatic",...x}=e,p=(0,d.jH)(i),[f,v]=(0,c.i)({prop:a,onChange:n,defaultProp:l});return(0,h.jsx)(g,{scope:s,baseId:(0,u.B)(),value:f,onValueChange:v,orientation:r,dir:p,activationMode:m,children:(0,h.jsx)(o.sG.div,{dir:p,"data-orientation":r,...x,ref:t})})});y.displayName=m;var j="TabsList",b=a.forwardRef((e,t)=>{let{__scopeTabs:s,loop:a=!0,...n}=e,l=v(j,s),i=f(s);return(0,h.jsx)(r.bL,{asChild:!0,...i,orientation:l.orientation,dir:l.dir,loop:a,children:(0,h.jsx)(o.sG.div,{role:"tablist","aria-orientation":l.orientation,...n,ref:t})})});b.displayName=j;var N="TabsTrigger",w=a.forwardRef((e,t)=>{let{__scopeTabs:s,value:a,disabled:l=!1,...i}=e,d=v(N,s),c=f(s),u=k(d.baseId,a),m=C(d.baseId,a),x=a===d.value;return(0,h.jsx)(r.q7,{asChild:!0,...c,focusable:!l,active:x,children:(0,h.jsx)(o.sG.button,{type:"button",role:"tab","aria-selected":x,"aria-controls":m,"data-state":x?"active":"inactive","data-disabled":l?"":void 0,disabled:l,id:u,...i,ref:t,onMouseDown:(0,n.m)(e.onMouseDown,e=>{l||0!==e.button||!1!==e.ctrlKey?e.preventDefault():d.onValueChange(a)}),onKeyDown:(0,n.m)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&d.onValueChange(a)}),onFocus:(0,n.m)(e.onFocus,()=>{let e="manual"!==d.activationMode;x||l||!e||d.onValueChange(a)})})})});w.displayName=N;var _="TabsContent",A=a.forwardRef((e,t)=>{let{__scopeTabs:s,value:n,forceMount:l,children:r,...d}=e,c=v(_,s),u=k(c.baseId,n),m=C(c.baseId,n),x=n===c.value,p=a.useRef(x);return a.useEffect(()=>{let e=requestAnimationFrame(()=>p.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,h.jsx)(i.C,{present:l||x,children:s=>{let{present:a}=s;return(0,h.jsx)(o.sG.div,{"data-state":x?"active":"inactive","data-orientation":c.orientation,role:"tabpanel","aria-labelledby":u,hidden:!a,id:m,tabIndex:0,...d,ref:t,style:{...e.style,animationDuration:p.current?"0s":void 0},children:a&&r})}})});function k(e,t){return"".concat(e,"-trigger-").concat(t)}function C(e,t){return"".concat(e,"-content-").concat(t)}A.displayName=_;var q=y,D=b,R=w,S=A},1397:(e,t,s)=>{"use strict";s.d(t,{k:()=>i});var a=s(5155),n=s(2115),l=s(5863),r=s(3999);let i=n.forwardRef((e,t)=>{let{className:s,value:n,...i}=e;return(0,a.jsx)(l.bL,{ref:t,className:(0,r.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...i,children:(0,a.jsx)(l.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(n||0),"%)")}})})});i.displayName=l.bL.displayName},3403:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=s(3464).A.create({baseURL:"/api"})},4964:(e,t,s)=>{"use strict";s.d(t,{Xi:()=>d,av:()=>c,j7:()=>o,tU:()=>i});var a=s(5155),n=s(2115),l=s(704),r=s(3999);let i=l.bL,o=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.B8,{ref:t,className:(0,r.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...n})});o.displayName=l.B8.displayName;let d=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.l9,{ref:t,className:(0,r.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...n})});d.displayName=l.l9.displayName;let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.UC,{ref:t,className:(0,r.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...n})});c.displayName=l.UC.displayName},5784:(e,t,s)=>{"use strict";s.d(t,{bq:()=>h,eb:()=>f,gC:()=>p,l6:()=>c,yv:()=>u});var a=s(5155),n=s(2115),l=s(8715),r=s(6474),i=s(7863),o=s(5196),d=s(3999);let c=l.bL;l.YJ;let u=l.WT,h=n.forwardRef((e,t)=>{let{className:s,children:n,...i}=e;return(0,a.jsxs)(l.l9,{ref:t,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...i,children:[n,(0,a.jsx)(l.In,{asChild:!0,children:(0,a.jsx)(r.A,{className:"h-4 w-4 opacity-50"})})]})});h.displayName=l.l9.displayName;let m=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.PP,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...n,children:(0,a.jsx)(i.A,{className:"h-4 w-4"})})});m.displayName=l.PP.displayName;let x=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.wn,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...n,children:(0,a.jsx)(r.A,{className:"h-4 w-4"})})});x.displayName=l.wn.displayName;let p=n.forwardRef((e,t)=>{let{className:s,children:n,position:r="popper",...i}=e;return(0,a.jsx)(l.ZL,{children:(0,a.jsxs)(l.UC,{ref:t,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:r,...i,children:[(0,a.jsx)(m,{}),(0,a.jsx)(l.LM,{className:(0,d.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n}),(0,a.jsx)(x,{})]})})});p.displayName=l.UC.displayName,n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.JU,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...n})}).displayName=l.JU.displayName;let f=n.forwardRef((e,t)=>{let{className:s,children:n,...r}=e;return(0,a.jsxs)(l.q7,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...r,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(l.VF,{children:(0,a.jsx)(o.A,{className:"h-4 w-4"})})}),(0,a.jsx)(l.p4,{children:n})]})});f.displayName=l.q7.displayName,n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.wv,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",s),...n})}).displayName=l.wv.displayName},5863:(e,t,s)=>{"use strict";s.d(t,{C1:()=>b,bL:()=>j});var a=s(2115),n=s(6081),l=s(3655),r=s(5155),i="Progress",[o,d]=(0,n.A)(i),[c,u]=o(i),h=a.forwardRef((e,t)=>{var s,a,n,i;let{__scopeProgress:o,value:d=null,max:u,getValueLabel:h=p,...m}=e;(u||0===u)&&!v(u)&&console.error((s="".concat(u),a="Progress","Invalid prop `max` of value `".concat(s,"` supplied to `").concat(a,"`. Only numbers greater than 0 are valid max values. Defaulting to `").concat(100,"`.")));let x=v(u)?u:100;null===d||y(d,x)||console.error((n="".concat(d),i="Progress","Invalid prop `value` of value `".concat(n,"` supplied to `").concat(i,"`. The `value` prop must be:\n  - a positive number\n  - less than the value passed to `max` (or ").concat(100," if no `max` prop is set)\n  - `null` or `undefined` if the progress is indeterminate.\n\nDefaulting to `null`.")));let j=y(d,x)?d:null,b=g(j)?h(j,x):void 0;return(0,r.jsx)(c,{scope:o,value:j,max:x,children:(0,r.jsx)(l.sG.div,{"aria-valuemax":x,"aria-valuemin":0,"aria-valuenow":g(j)?j:void 0,"aria-valuetext":b,role:"progressbar","data-state":f(j,x),"data-value":null!=j?j:void 0,"data-max":x,...m,ref:t})})});h.displayName=i;var m="ProgressIndicator",x=a.forwardRef((e,t)=>{var s;let{__scopeProgress:a,...n}=e,i=u(m,a);return(0,r.jsx)(l.sG.div,{"data-state":f(i.value,i.max),"data-value":null!==(s=i.value)&&void 0!==s?s:void 0,"data-max":i.max,...n,ref:t})});function p(e,t){return"".concat(Math.round(e/t*100),"%")}function f(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function g(e){return"number"==typeof e}function v(e){return g(e)&&!isNaN(e)&&e>0}function y(e,t){return g(e)&&!isNaN(e)&&e<=t&&e>=0}x.displayName=m;var j=h,b=x},7340:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(9946).A)("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]])},8074:(e,t,s)=>{"use strict";s.d(t,{O:()=>d});var a=s(5155),n=s(2115),l=s(5695),r=s(9894),i=s(8482),o=s(1976);function d(e){let{children:t,requiredRole:s,redirectTo:d="/login"}=e,[c,u]=(0,n.useState)(null),[h,m]=(0,n.useState)(!0),x=(0,l.useRouter)();return((0,n.useEffect)(()=>{let e=(0,r.HW)();if(!e){x.push(d);return}if(s&&("user"===s&&"admin"===e.role||"user"!==s&&e.role!==s)){"admin"===e.role?x.push("/admin/dashboard"):"staff"===e.role?x.push("/staff/dashboard"):x.push("/user/dashboard");return}u(e),m(!1)},[x,s,d]),h)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsx)(i.Zp,{className:"w-full max-w-md",children:(0,a.jsxs)(i.Wu,{className:"flex flex-col items-center justify-center p-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-red-500 rounded-full flex items-center justify-center mb-4 animate-pulse",children:(0,a.jsx)(o.A,{className:"w-8 h-8 text-white"})}),(0,a.jsx)("p",{className:"text-gray-600",children:"Đang kiểm tra quyền truy cập..."})]})})}):c?(0,a.jsx)(a.Fragment,{children:t}):null}},8145:(e,t,s)=>{"use strict";s.d(t,{E:()=>i});var a=s(5155);s(2115);var n=s(2085),l=s(3999);let r=(0,n.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:s,...n}=e;return(0,a.jsx)("div",{className:(0,l.cn)(r({variant:s}),t),...n})}},8256:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>S});var a=s(5155),n=s(8074),l=s(8482),r=s(7168),i=s(8145),o=s(4964),d=s(1397),c=s(5784),u=s(9946);let h=(0,u.A)("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);var m=s(7340),x=s(4835),p=s(8691);let f=(0,u.A)("Hospital",[["path",{d:"M12 6v4",key:"16clxf"}],["path",{d:"M14 14h-4",key:"esezmu"}],["path",{d:"M14 18h-4",key:"16mqa2"}],["path",{d:"M14 8h-4",key:"z8ypaz"}],["path",{d:"M18 12h2a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-9a2 2 0 0 1 2-2h2",key:"b1k337"}],["path",{d:"M18 22V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v18",key:"16g51d"}]]);var g=s(1976),v=s(446),y=s(646);let j=(0,u.A)("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);var b=s(6874),N=s.n(b),w=s(6766),_=s(395),A=s(7746),k=s(3403),C=s(2115),q=s(3568);function D(e){return({pending:"Chờ duyệt",approved:"Đ\xe3 duyệt",matched:"Đ\xe3 gh\xe9p",in_progress:"Đang xử l\xfd",completed:"Ho\xe0n tất",cancelled:"Đ\xe3 hủy",rejected:"Từ chối",scheduled:"Đ\xe3 l\xean lịch",fulfilled:"Đ\xe3 thực hiện"})[e]||e}function R(e){let t={whole:"M\xe1u to\xe0n phần",plasma:"Huyết tương",rbc:"Hồng cầu",RBC:"Hồng cầu",platelet:"Tiểu cầu"};return t[null==e?void 0:e.toLowerCase()]||t[e]||e}function S(){var e,t,s;let{user:u,logout:b}=(0,_.A)(),[S,T]=(0,C.useState)({}),[K,E]=(0,C.useState)([]),[M,L]=(0,C.useState)([]),[B,V]=(0,C.useState)([]),[Z,F]=(0,C.useState)([]),[H,z]=(0,C.useState)({}),[U,I]=(0,C.useState)("donor"),[P,W]=(0,C.useState)([]),[G,O]=(0,C.useState)({}),[Q,X]=(0,C.useState)({}),[$,Y]=(0,C.useState)([]),[J,ee]=(0,C.useState)({}),[et,es]=(0,C.useState)("newest"),ea=async(e,t)=>{try{if(await k.A.put("/staff/donations/".concat(t,"/update-status"),{status:e}),V(s=>s.map(s=>s._id===t?{...s,status:e}:s)),q.Ay.success("Đ\xe3 thay đổi status th\xe0nh ".concat(e)),"completed"===e){let e=await k.A.get("/staff/donations/id/".concat(t)),s=e.data.donation.donor_id._id,a=e.data.donation.donation_date,n=new Date(a),l=new Date(n.getTime()+6048e5).toISOString();await k.A.put("/users/donor/update-cooldown",{user_id:s,cooldown_until:l})}}catch(e){q.Ay.error("Đ\xe3 xảy ra lỗi khi cập nhật trạng th\xe1i. Vui l\xf2ng thử lại!"),console.error(e)}},en=async(e,t)=>{try{await k.A.put("/staff/donations-blood-inventory/".concat(t,"/update-status"),{status:e}),W(s=>s.map(s=>{var a,n;if(s._id!==t)return s;let l="cancelled"===e&&"cancelled"!==s.status,r="cancelled"===s.status&&("in_progress"===e||"fulfilled"===e);if(r&&(null===(a=s.inventory_item)||void 0===a?void 0:a.quantity)&&s.inventory_item.quantity<s.volume)return q.Ay.error("Kh\xf4ng đủ m\xe1u trong kho để phục hồi lại trạng th\xe1i!"),s;let i=(null===(n=s.inventory_item)||void 0===n?void 0:n.quantity)||0;return l?i+=s.volume:r&&(i-=s.volume),{...s,status:e,inventory_item:{...s.inventory_item,quantity:i}}})),q.Ay.success("Đ\xe3 thay đổi status th\xe0nh ".concat(e))}catch(e){q.Ay.error("Đ\xe3 xảy ra lỗi khi cập nhật trạng th\xe1i. Vui l\xf2ng thử lại!"),console.error(e)}},el=async(e,t)=>{var s,a,n,l,r,i,o;try{if(console.log("Updating donor request:",{newStatus:e,requestId:t}),!(null==u?void 0:u._id)){q.Ay.error("Kh\xf4ng t\xecm thấy th\xf4ng tin người d\xf9ng!");return}if(!(null==S?void 0:null===(s=S.hospital)||void 0===s?void 0:s._id)){q.Ay.error("Kh\xf4ng t\xecm thấy th\xf4ng tin bệnh viện!");return}let i=$.find(e=>e._id===t);if(!i){q.Ay.error("Kh\xf4ng t\xecm thấy th\xf4ng tin y\xeau cầu hiến m\xe1u!");return}let o="completed"===e&&"completed"!==i.status,d="cancelled"===e&&"completed"===i.status;if(o||d){let e=(null===(a=i.components_offered)||void 0===a?void 0:a[0])||"whole";console.log("\uD83D\uDD0D Debug inventory operation:"),console.log("Target blood_type:",i.blood_type_offered),console.log("Target component:",e),console.log("Request components_offered:",i.components_offered),console.log("Amount:",i.amount_offered),console.log("Operation:",o?"ADD":"SUBTRACT");try{if(o){let{inventory:t,action:s}=ed(i.blood_type_offered,e,i.amount_offered);if("update"===s&&t){let e=t.quantity+i.amount_offered;await k.A.put("/blood-in/blood-inventory/update/".concat(t._id),{quantity:e}),console.log("✅ Updated inventory: ".concat(t.blood_type," (").concat(t.component,") from ").concat(t.quantity,"ml to ").concat(e,"ml"))}else if("create"===s){let t={hospital:S.hospital._id,blood_type:i.blood_type_offered,component:e,quantity:i.amount_offered,expiring_quantity:0,low_stock_alert:!1};await k.A.post("/blood-in/blood-inventory/create",t),console.log("✅ Created new inventory: ".concat(i.blood_type_offered," (").concat(e,") with ").concat(i.amount_offered,"ml"))}}else if(d){let{inventory:t}=ed(i.blood_type_offered,e,i.amount_offered);if(t){let e=t.quantity-i.amount_offered;if(e<0){q.Ay.error("Kh\xf4ng thể hủy: kh\xf4ng đủ m\xe1u trong kho để trừ!");return}await k.A.put("/blood-in/blood-inventory/update/".concat(t._id),{quantity:e}),console.log("✅ Updated inventory for cancellation: ".concat(t.blood_type," (").concat(t.component,") from ").concat(t.quantity,"ml to ").concat(e,"ml"))}else{q.Ay.error("Kh\xf4ng t\xecm thấy kho m\xe1u để trừ khi hủy!");return}}}catch(e){console.error("Error handling inventory:",e),q.Ay.error("Lỗi xử l\xfd kho m\xe1u: ".concat((null===(l=e.response)||void 0===l?void 0:null===(n=l.data)||void 0===n?void 0:n.message)||e.message));return}}if(await k.A.put("/users/donor-requests/staff/".concat(t,"/status"),{status:e,staff_id:u._id}),o||d)try{await eo(),q.Ay.success(o?"✅ Đ\xe3 ho\xe0n tất hiến m\xe1u v\xe0 th\xeam ".concat(i.amount_offered,"ml m\xe1u ").concat(i.blood_type_offered," (").concat(R(null===(r=i.components_offered)||void 0===r?void 0:r[0]),") v\xe0o kho"):"❌ Đ\xe3 hủy v\xe0 trừ ".concat(i.amount_offered,"ml m\xe1u ").concat(i.blood_type_offered," khỏi kho"))}catch(e){console.error("Error refreshing inventory:",e),q.Ay.error("Cập nhật th\xe0nh c\xf4ng nhưng kh\xf4ng thể l\xe0m mới dữ liệu kho. Vui l\xf2ng tải lại trang.")}Y(s=>s.map(s=>s._id===t?{...s,status:e}:s)),o||d||q.Ay.success("Đ\xe3 thay đổi trạng th\xe1i th\xe0nh ".concat(D(e)))}catch(e){q.Ay.error("Đ\xe3 xảy ra lỗi khi cập nhật trạng th\xe1i. Vui l\xf2ng thử lại!"),console.error("Error updating donor request status:",e),console.error("Error response:",null===(i=e.response)||void 0===i?void 0:i.data),console.error("Error status:",null===(o=e.response)||void 0===o?void 0:o.status)}},er=e=>{let t=new Date;return new Date(e)<=t},ei=e=>{let t=new Date(e),s=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0"),n=t.getFullYear();return"".concat(s,"/").concat(a,"/").concat(n)},eo=async()=>{try{var e;if(!(null==S?void 0:null===(e=S.hospital)||void 0===e?void 0:e._id))return;let t=await k.A.get("/blood-in/blood-inventory/hospital/".concat(S.hospital._id));F(t.data.inventories);let s=await k.A.get("/users/donor/staff/get-requests-by-hospital/".concat(S.hospital._id));Y(s.data.requests),console.log("✅ Refreshed blood inventory and donor requests data")}catch(e){console.error("❌ Failed to refresh blood inventory data:",e)}},ed=(e,t,s)=>{let a=Z.find(s=>{var a;return s.blood_type===e&&(null===(a=s.component)||void 0===a?void 0:a.toLowerCase())===(null==t?void 0:t.toLowerCase())});return a?(console.log("✅ Found exact match:",a),{inventory:a,action:"update"}):"whole"!==t&&(a=Z.find(t=>{var s;return t.blood_type===e&&(null===(s=t.component)||void 0===s?void 0:s.toLowerCase())==="whole"}))?(console.log("✅ Found fallback with 'whole' component:",a),{inventory:a,action:"update"}):(a=Z.find(t=>t.blood_type===e))?(console.log("✅ Found inventory with same blood type but different component:",a),{inventory:a,action:"update"}):(console.log("❗ No existing inventory found, will create new"),{inventory:null,action:"create"})};(0,C.useEffect)(()=>{async function e(){try{var e,t,s,a,n,l;if(!(null==u?void 0:u._id))return;let r=(await k.A.get("/users/staff-profiles/active/".concat(u._id))).data.staffProfile;if(T(r),null==r?void 0:null===(e=r.hospital)||void 0===e?void 0:e._id){console.log("\uD83C\uDFE5 Hospital ID:",r.hospital._id),console.log("\uD83D\uDD17 API URL:","/users/donor-profiles-by-hospital/".concat(r.hospital._id));let e=await k.A.get("/users/donor-profiles-by-hospital/".concat(r.hospital._id));console.log("\uD83D\uDCCA Raw donor list response:",e.data),console.log("\uD83D\uDCCA Donor count:",null===(t=e.data)||void 0===t?void 0:t.count),console.log("\uD83D\uDCCA Donors array:",null===(s=e.data)||void 0===s?void 0:s.donors),console.log("\uD83D\uDCCA Donors array length:",null===(n=e.data)||void 0===n?void 0:null===(a=n.donors)||void 0===a?void 0:a.length),E(e.data);let i={};(null===(l=e.data)||void 0===l?void 0:l.donors)&&(console.log("\uD83D\uDD04 Starting to fetch donation counts for",e.data.donors.length,"donors"),await Promise.all(e.data.donors.map(async e=>{var t,s,a,n,l;try{if(!(null===(t=e.user_id)||void 0===t?void 0:t._id)){console.warn("⚠️ Donor missing user_id or _id:",e);return}let n=await k.A.get("/donations/donor/".concat(e.user_id._id)),l=(null===(s=n.data.data)||void 0===s?void 0:s.filter(e=>"completed"===e.status))||[];i[e.user_id._id]=l.length,console.log("\uD83D\uDC89 Donor ".concat((null===(a=e.user_id)||void 0===a?void 0:a.full_name)||"Kh\xf4ng r\xf5 t\xean",": ").concat(l.length," completed donations"))}catch(t){console.error("❌ Failed to fetch donations for donor ".concat(null===(n=e.user_id)||void 0===n?void 0:n._id,":"),t),(null===(l=e.user_id)||void 0===l?void 0:l._id)&&(i[e.user_id._id]=0)}}))),console.log("\uD83D\uDCCA Final donation counts:",i),ee(i);let o=await k.A.get("/staff/blood-requests/get-list/".concat(r.hospital._id));L(o.data);let d=await k.A.get("/staff/donations/by-staff/".concat(u._id));V(d.data.data);let c=await k.A.get("/blood-in/blood-inventory/hospital/".concat(r.hospital._id));F(c.data.inventories);let h=await k.A.get("/staff/donations-warehouse/by-staff/".concat(u._id));W(h.data.data);let m=await k.A.get("/users/donor/staff/get-requests-by-hospital/".concat(r.hospital._id));Y(m.data.requests)}}catch(e){console.error("Failed to fetch staff profile or hospital:",e)}}(null==u?void 0:u._id)&&e()},[u]);let ec={totalDonors:(null==K?void 0:K.count)||0,activeDonors:(null==K?void 0:null===(e=K.donors)||void 0===e?void 0:e.filter(e=>er(e.availability_date)).length)||0,totalBloodUnits:(null==Z?void 0:Z.reduce((e,t)=>e+t.quantity,0))||0,lowStockTypes:(null==Z?void 0:Z.filter(e=>e.quantity<50).length)||0,pendingRequests:(null==M?void 0:M.count)||0,completedToday:(null==B?void 0:B.filter(e=>{let t=new Date().toDateString();return new Date(e.donation_date).toDateString()===t&&"completed"===e.status}).length)||0,totalDonationsStat:Object.values(J).reduce((e,t)=>e+t,0),pendingDonorRequests:(null==$?void 0:$.filter(e=>"in_progress"===e.status).length)||0,completedDonorRequests:(null==$?void 0:$.filter(e=>"completed"===e.status).length)||0,totalVolumeFromDonorRequests:(null==$?void 0:$.filter(e=>"completed"===e.status).reduce((e,t)=>e+(t.amount_offered||0),0))||0},eu=e=>{switch(e){case"active":case"completed":return"bg-green-100 text-green-800";case"inactive":default:return"bg-gray-100 text-gray-800";case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-blue-100 text-blue-800"}},eh=e=>e<30?"bg-red-100 text-red-800":e<150?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800";return(0,a.jsx)(n.O,{requiredRole:"staff",children:(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[(0,a.jsx)("header",{className:"bg-white border-b sticky top-0 z-50",children:(0,a.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)(N(),{href:"/",className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full overflow-hidden",children:(0,a.jsx)(w.default,{src:"/images/logo.webp",alt:"ScαrletBlood Logo",width:40,height:40,className:"w-full h-full object-cover"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"ScαrletBlood Staff"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Bảng điều khiển nh\xe2n vi\xean"})]})]}),(0,a.jsxs)(i.E,{className:"bg-blue-100 text-blue-800",children:[(0,a.jsx)(h,{className:"w-3 h-3 mr-1"}),"Nh\xe2n vi\xean"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["Xin ch\xe0o, ",(0,a.jsx)("strong",{children:"Staff"})]}),(0,a.jsx)(r.$,{variant:"outline",size:"sm",asChild:!0,children:(0,a.jsxs)(N(),{href:"/",children:[(0,a.jsx)(m.A,{className:"w-4 h-4 mr-2"}),"Về trang chủ"]})}),(0,a.jsxs)(r.$,{variant:"outline",size:"sm",onClick:()=>{b()},children:[(0,a.jsx)(x.A,{className:"w-4 h-4 mr-2"}),"Đăng xuất"]})]})]})})}),(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8 flex-grow",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8",children:[(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(l.ZB,{className:"text-sm font-medium",children:"Kho m\xe1u tổng"}),(0,a.jsx)(p.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(l.Wu,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-red-600",children:[ec.totalBloodUnits," ml"]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:ec.lowStockTypes>0?"".concat(ec.lowStockTypes," loại thiếu"):"T\xecnh trạng tốt"})]})]}),(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(l.ZB,{className:"text-sm font-medium",children:"Y\xeau cầu m\xe1u"}),(0,a.jsx)(f,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(l.Wu,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:ec.pendingRequests}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"đang chờ xử l\xfd"})]})]}),(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(l.ZB,{className:"text-sm font-medium",children:"Hiến m\xe1u v\xe0o kho"}),(0,a.jsx)(g.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(l.Wu,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:ec.completedDonorRequests}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["đ\xe3 ho\xe0n tất | ",ec.pendingDonorRequests," đang xử l\xfd"]})]})]}),(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(l.ZB,{className:"text-sm font-medium",children:"M\xe1u nhận được"}),(0,a.jsx)(v.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(l.Wu,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:[ec.totalVolumeFromDonorRequests," ml"]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"từ hiến m\xe1u v\xe0o kho"})]})]}),(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(l.ZB,{className:"text-sm font-medium",children:"Cơ sở l\xe0m việc"}),(0,a.jsx)(y.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(l.Wu,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:(null==S?void 0:null===(t=S.hospital)||void 0===t?void 0:t.name)||"Kh\xf4ng c\xf3 th\xf4ng tin"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:(null==S?void 0:null===(s=S.hospital)||void 0===s?void 0:s.address)||"Kh\xf4ng c\xf3 th\xf4ng tin"})]})]})]}),(0,a.jsxs)(o.tU,{defaultValue:"inventory",className:"space-y-6",children:[(0,a.jsxs)(o.j7,{className:"grid w-full grid-cols-3",children:[(0,a.jsx)(o.Xi,{value:"inventory",children:"Kho m\xe1u"}),(0,a.jsx)(o.Xi,{value:"requests",children:"Y\xeau cầu m\xe1u"}),(0,a.jsx)(o.Xi,{value:"reports",children:"Quản l\xfd lịch tr\xecnh hiến m\xe1u"})]}),(0,a.jsx)(o.av,{value:"inventory",className:"space-y-6",children:(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsx)(l.ZB,{className:"flex items-center justify-between",children:(0,a.jsxs)("span",{className:"flex items-center",children:[(0,a.jsx)(j,{className:"w-5 h-5 mr-2"}),"Quản l\xfd kho m\xe1u"]})}),(0,a.jsx)(l.BT,{children:"Theo d\xf5i tồn kho v\xe0 t\xecnh trạng m\xe1u theo từng nh\xf3m"})]}),(0,a.jsx)(l.Wu,{children:(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:Z.map(e=>(0,a.jsxs)(l.Zp,{className:"relative",children:[(0,a.jsx)(l.aR,{className:"pb-2",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(l.ZB,{className:"text-lg font-bold text-red-600",children:e.blood_type}),(0,a.jsx)(i.E,{className:eh(e.quantity),children:e.quantity<30?"Rất thấp":e.quantity<150?"Thấp":"Tốt"})]})}),(0,a.jsx)(l.Wu,{children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{children:"C\xf3 sẵn:"}),(0,a.jsxs)("span",{className:"font-semibold",children:[e.quantity," ml"]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{children:"Đ\xe3 đặt:"}),(0,a.jsx)("span",{className:"font-semibold",children:"0 ml"})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{children:"Sắp hết hạn:"}),(0,a.jsxs)("span",{className:"font-semibold text-orange-600",children:[e.expiring_quantity," ml"]})]}),(0,a.jsx)(d.k,{value:Math.min(e.quantity/5e4*100,100),className:"h-2 mt-2"})]})})]},e.blood_type))})})]})}),(0,a.jsx)(o.av,{value:"requests",className:"space-y-6",children:(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsxs)(l.ZB,{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:"Quản l\xfd y\xeau cầu m\xe1u"}),(0,a.jsxs)(c.l6,{onValueChange:es,defaultValue:"newest",children:[(0,a.jsx)(c.bq,{className:"w-48",children:(0,a.jsx)(c.yv,{placeholder:"Sắp xếp theo"})}),(0,a.jsxs)(c.gC,{children:[(0,a.jsx)(c.eb,{value:"newest",children:"Mới nhất"}),(0,a.jsx)(c.eb,{value:"oldest",children:"Cũ nhất"}),(0,a.jsx)(c.eb,{value:"emergency",children:"Khẩn cấp"})]})]})]}),(0,a.jsx)(l.BT,{children:"Quản l\xfd th\xf4ng tin về y\xeau cầu m\xe1u"})]}),(0,a.jsx)(l.Wu,{children:(0,a.jsx)("div",{className:"space-y-4",children:(e=>{if(!Array.isArray(e))return[];let t=[...e];switch(et){case"newest":return t.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime());case"oldest":return t.sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime());case"emergency":return t.sort((e,t)=>e.is_emergency&&!t.is_emergency?-1:!e.is_emergency&&t.is_emergency?1:new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime());default:return t}})(M.data||[]).map(e=>{var t,s,n,l,r,o,d;return(0,a.jsx)(N(),{href:"/staff/edit/request?requestId=".concat(e._id),className:"block",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row justify-between p-4 border rounded-lg space-y-4 md:space-y-0 md:space-x-6 hover:bg-gray-50 transition",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(g.A,{className:"w-6 h-6 text-orange-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:(null===(t=e.recipient_id)||void 0===t?void 0:t.full_name)||"Kh\xf4ng r\xf5 t\xean"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:(null===(s=e.recipient_id)||void 0===s?void 0:s.email)||"Kh\xf4ng r\xf5 email"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["SĐT: ",(null===(n=e.recipient_id)||void 0===n?void 0:n.phone)||"Kh\xf4ng r\xf5 SĐT"]})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[(0,a.jsx)(i.E,{variant:"outline",className:"text-red-600",children:e.blood_type_needed}),(0,a.jsx)(i.E,{className:"bg-blue-100 text-blue-800",children:(null===(l=e.components_needed)||void 0===l?void 0:l.map(e=>R(e)).join(", "))||"Kh\xf4ng r\xf5"}),(0,a.jsx)(i.E,{className:e.is_emergency?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800",children:e.is_emergency?"Khẩn cấp":"Kh\xf4ng khẩn cấp"}),(0,a.jsx)(i.E,{className:eu(e.status),children:D(e.status)})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,a.jsxs)("p",{children:["Số lượng cần: ",(0,a.jsx)("strong",{children:e.amount_needed})," ml"]}),(0,a.jsxs)("p",{children:["Khoảng c\xe1ch: ",(0,a.jsxs)("strong",{children:[e.distance," km"]})]}),(0,a.jsxs)("p",{children:["Ghi ch\xfa: ",e.comment||"Kh\xf4ng c\xf3"]}),(0,a.jsxs)("p",{children:["Ng\xe0y tạo: ",ei(e.createdAt)]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col justify-between items-end space-y-3 min-w-[220px]",children:[(0,a.jsxs)("div",{className:"text-right text-sm",children:[(0,a.jsx)("p",{className:"font-medium text-gray-800",children:(null===(r=e.hospital)||void 0===r?void 0:r.name)||"Kh\xf4ng r\xf5 bệnh viện"}),(0,a.jsx)("p",{className:"text-gray-600",children:(null===(o=e.hospital)||void 0===o?void 0:o.address)||"Kh\xf4ng r\xf5 địa chỉ"}),(0,a.jsxs)("p",{className:"text-gray-600",children:["SĐT: ",(null===(d=e.hospital)||void 0===d?void 0:d.phone)||"Kh\xf4ng r\xf5 SĐT"]})]}),(0,a.jsx)("div",{className:"flex space-x-2"})]})]})},e._id)})})})]})}),(0,a.jsx)(o.av,{value:"reports",className:"space-y-6",children:(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsxs)(l.ZB,{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:"Quản l\xfd lịch tr\xecnh hiến m\xe1u"}),(0,a.jsxs)(c.l6,{onValueChange:I,children:[(0,a.jsx)(c.bq,{className:"w-48",children:(0,a.jsx)(c.yv,{placeholder:"Loại quản l\xfd"})}),(0,a.jsxs)(c.gC,{children:[(0,a.jsx)(c.eb,{value:"donor",children:"Truyền M\xe1u"}),(0,a.jsx)(c.eb,{value:"blood-inventory",children:"Y\xeau Cầu M\xe1u Trong Kho"}),(0,a.jsx)(c.eb,{value:"donor-request",children:"Hiến M\xe1u V\xe0o Kho"})]})]})]}),(0,a.jsx)(l.BT,{children:"Quản l\xfd th\xf4ng tin về lịch tr\xecnh hiến m\xe1u"})]}),(0,a.jsx)(l.Wu,{children:(0,a.jsxs)(l.Wu,{className:"space-y-4",children:["donor"===U&&Array.isArray(B)&&B.length>0?B.map(e=>{var t,s,n,l,o,d,u,h,m;return(0,a.jsxs)("div",{className:"flex flex-col md:flex-row justify-between p-4 border rounded-lg space-y-4 md:space-y-0 md:space-x-6 hover:bg-gray-50 transition",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(g.A,{className:"w-6 h-6 text-red-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium",children:["Người hiến: ",(null===(t=e.donor_id)||void 0===t?void 0:t.full_name)||"Kh\xf4ng r\xf5"]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:null===(s=e.donor_id)||void 0===s?void 0:s.email}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["SĐT: ",null===(n=e.donor_id)||void 0===n?void 0:n.phone]})]})]}),e.recipient_id&&(0,a.jsxs)("div",{className:"mt-2 border-t pt-2",children:[(0,a.jsxs)("p",{className:"font-medium",children:["Người nhận: ",null===(l=e.recipient_id)||void 0===l?void 0:l.full_name]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:null===(o=e.recipient_id)||void 0===o?void 0:o.email}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["SĐT: ",null===(d=e.recipient_id)||void 0===d?void 0:d.phone]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[(0,a.jsx)(i.E,{className:"bg-blue-100 text-blue-800",children:null===(u=e.donation_type)||void 0===u?void 0:u.map(e=>R(e)).join(", ")}),(0,a.jsx)(i.E,{className:"scheduled"===e.status?"bg-yellow-100 text-yellow-800":"completed"===e.status?"bg-green-100 text-green-800":"cancelled"===e.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800",children:D(e.status)})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:[(0,a.jsxs)("p",{children:["Ng\xe0y hiến: ",(0,a.jsx)("strong",{children:ei(e.donation_date)})]}),(0,a.jsxs)("p",{children:["Khối lượng: ",(0,a.jsx)("strong",{children:e.volume})," ml"]}),(0,a.jsxs)("p",{children:["Ghi ch\xfa: ",e.notes||"Kh\xf4ng c\xf3"]}),(0,a.jsxs)("p",{children:["Ng\xe0y tạo: ",ei(e.createdAt)]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col justify-between items-end space-y-3 min-w-[220px]",children:[(0,a.jsxs)("div",{className:"text-right text-sm",children:[(0,a.jsx)("p",{className:"font-medium text-gray-800",children:"Cập nhật bởi:"}),(0,a.jsx)("p",{className:"text-gray-600",children:(null===(h=e.updated_by)||void 0===h?void 0:h.full_name)||"Chưa r\xf5"}),(0,a.jsx)("p",{className:"text-gray-600",children:(null===(m=e.updated_by)||void 0===m?void 0:m.email)||"-"}),(0,a.jsx)("p",{className:"font-medium text-gray-800",children:"\uD83D\uDEE0 Cập nhật trạng th\xe1i:"}),(0,a.jsxs)(c.l6,{onValueChange:t=>z(s=>({...s,[e._id]:t})),value:H[e._id]||"",children:[(0,a.jsx)(c.bq,{className:"w-full md:w-[300px] border-gray-300",children:(0,a.jsx)(c.yv,{placeholder:"Chọn trạng th\xe1i"})}),(0,a.jsx)(c.gC,{children:[{key:"scheduled",label:"Đ\xe3 l\xean lịch"},{key:"completed",label:"Đ\xe3 ho\xe0n tất"},{key:"cancelled",label:"Đ\xe3 hủy"}].map(e=>(0,a.jsx)(c.eb,{value:e.key,children:e.label},e.key))})]}),(0,a.jsx)(r.$,{className:"mt-2 bg-blue-600 text-white hover:bg-blue-700",disabled:!H[e._id]||H[e._id]===(null==e?void 0:e.status),onClick:()=>ea(H[e._id],e._id),children:"Cập nhật trạng th\xe1i"})]}),(0,a.jsx)("div",{className:"flex space-x-2"})]})]},e._id)}):"blood-inventory"===U?"":"donor-request"===U?"":(0,a.jsx)("p",{className:"text-gray-600",children:"Kh\xf4ng t\xecm thấy dữ liệu truyền m\xe1u."}),"blood-inventory"===U&&Array.isArray(P)&&P.length>0?P.map(e=>{var t,s,n,l,o,d,u,h,m;return(0,a.jsxs)("div",{className:"flex flex-col md:flex-row justify-between p-4 border rounded-lg space-y-4 md:space-y-0 md:space-x-6 hover:bg-gray-50 transition",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(v.A,{className:"w-6 h-6 text-blue-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium",children:["Nh\xf3m m\xe1u: ",(null===(t=e.inventory_item)||void 0===t?void 0:t.blood_type)||"Kh\xf4ng r\xf5"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Th\xe0nh phần: ",R(null===(s=e.inventory_item)||void 0===s?void 0:s.component)]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Lượng tồn: ",null===(n=e.inventory_item)||void 0===n?void 0:n.quantity," ml"]})]})]}),e.recipient_id&&(0,a.jsxs)("div",{className:"mt-2 border-t pt-2",children:[(0,a.jsxs)("p",{className:"font-medium",children:["Người nhận: ",null===(l=e.recipient_id)||void 0===l?void 0:l.full_name]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:null===(o=e.recipient_id)||void 0===o?void 0:o.email}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["SĐT: ",null===(d=e.recipient_id)||void 0===d?void 0:d.phone]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[(0,a.jsx)(i.E,{className:"bg-blue-100 text-blue-800",children:R(null===(u=e.inventory_item)||void 0===u?void 0:u.component)}),(0,a.jsx)(i.E,{className:"in_progress"===e.status?"bg-yellow-100 text-yellow-800":"fulfilled"===e.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800",children:D(e.status)})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:[(0,a.jsxs)("p",{children:["Ng\xe0y r\xfat m\xe1u: ",(0,a.jsx)("strong",{children:ei(e.donation_date)})]}),(0,a.jsxs)("p",{children:["Khối lượng r\xfat: ",(0,a.jsx)("strong",{children:e.volume})," ml"]}),(0,a.jsxs)("p",{children:["Ghi ch\xfa: ",e.notes||"Kh\xf4ng c\xf3"]}),(0,a.jsxs)("p",{children:["Ng\xe0y tạo: ",ei(e.createdAt)]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col justify-between items-end space-y-3 min-w-[220px]",children:[(0,a.jsxs)("div",{className:"text-right text-sm",children:[(0,a.jsx)("p",{className:"font-medium text-gray-800",children:"Cập nhật bởi:"}),(0,a.jsx)("p",{className:"text-gray-600",children:(null===(h=e.updated_by)||void 0===h?void 0:h.full_name)||"Chưa r\xf5"}),(0,a.jsx)("p",{className:"text-gray-600",children:(null===(m=e.updated_by)||void 0===m?void 0:m.email)||"-"}),(0,a.jsx)("p",{className:"font-medium text-gray-800",children:"\uD83D\uDEE0 Cập nhật trạng th\xe1i:"}),(0,a.jsxs)(c.l6,{onValueChange:t=>O(s=>({...s,[e._id]:t})),value:G[e._id]||"",children:[(0,a.jsx)(c.bq,{className:"w-full md:w-[300px] border-gray-300",children:(0,a.jsx)(c.yv,{placeholder:"Chọn trạng th\xe1i"})}),(0,a.jsx)(c.gC,{children:[{key:"in_progress",label:"Đang tiến h\xe0nh"},{key:"fulfilled",label:"Đ\xe3 ho\xe0n tất"},{key:"cancelled",label:"Đ\xe3 hủy"}].map(e=>(0,a.jsx)(c.eb,{value:e.key,children:e.label},e.key))})]}),(0,a.jsx)(r.$,{className:"mt-2 bg-blue-600 text-white hover:bg-blue-700",disabled:!G[e._id]||G[e._id]===e.status,onClick:()=>en(G[e._id],e._id),children:"Cập nhật trạng th\xe1i"})]}),(0,a.jsx)("div",{className:"flex space-x-2"})]})]},e._id)}):"donor"===U?"":"donor-request"===U?"":(0,a.jsx)("p",{className:"text-gray-600",children:"Kh\xf4ng t\xecm thấy dữ liệu y\xeau cầu m\xe1u trong kho."}),"donor-request"===U&&Array.isArray($)&&$.length>0?$.map(e=>{var t,s,n,l,o,d,u,h;return(0,a.jsxs)("div",{className:"flex flex-col md:flex-row justify-between p-4 border rounded-lg space-y-4 md:space-y-0 md:space-x-6 hover:bg-gray-50 transition",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(v.A,{className:"w-6 h-6 text-green-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium",children:["Người hiến: ",(null===(t=e.donor_id)||void 0===t?void 0:t.full_name)||"Kh\xf4ng r\xf5"]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:null===(s=e.donor_id)||void 0===s?void 0:s.email}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["SĐT: ",null===(n=e.donor_id)||void 0===n?void 0:n.phone]})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[(0,a.jsx)(i.E,{variant:"outline",className:"text-red-600",children:e.blood_type_offered}),(0,a.jsx)(i.E,{className:"bg-blue-100 text-blue-800",children:null===(l=e.components_offered)||void 0===l?void 0:l.map(e=>R(e)).join(", ")}),(0,a.jsx)(i.E,{className:"in_progress"===e.status?"bg-yellow-100 text-yellow-800":"completed"===e.status?"bg-green-100 text-green-800":"cancelled"===e.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800",children:D(e.status)})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:[(0,a.jsxs)("p",{children:["Ng\xe0y hiến dự kiến: ",(0,a.jsx)("strong",{children:ei(e.available_date)})]}),(0,a.jsxs)("p",{children:["Khung giờ: ",(0,a.jsxs)("strong",{children:[null===(o=e.available_time_range)||void 0===o?void 0:o.from," - ",null===(d=e.available_time_range)||void 0===d?void 0:d.to]})]}),(0,a.jsxs)("p",{children:["Số lượng: ",(0,a.jsx)("strong",{children:e.amount_offered})," ml"]}),(0,a.jsxs)("p",{children:["Ghi ch\xfa: ",e.comment||"Kh\xf4ng c\xf3"]}),(0,a.jsxs)("p",{children:["Ng\xe0y tạo: ",ei(e.createdAt)]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col justify-between items-end space-y-3 min-w-[220px]",children:[(0,a.jsxs)("div",{className:"text-right text-sm",children:[(0,a.jsx)("p",{className:"font-medium text-gray-800",children:null===(u=e.hospital)||void 0===u?void 0:u.name}),(0,a.jsx)("p",{className:"text-gray-600",children:null===(h=e.hospital)||void 0===h?void 0:h.address}),(()=>{var t;let s=(null===(t=e.components_offered)||void 0===t?void 0:t[0])||"whole",n=Z.find(t=>{var a;return t.blood_type===e.blood_type_offered&&(null===(a=t.component)||void 0===a?void 0:a.toLowerCase())===(null==s?void 0:s.toLowerCase())});n||"whole"===s||(n=Z.find(t=>{var s;return t.blood_type===e.blood_type_offered&&(null===(s=t.component)||void 0===s?void 0:s.toLowerCase())==="whole"})),n||(n=Z.find(t=>t.blood_type===e.blood_type_offered));let l="completed"===Q[e._id]&&"completed"!==e.status;return"cancelled"===Q[e._id]&&e.status,n?null:(0,a.jsxs)("div",{className:"mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded text-xs",children:[(0,a.jsx)("p",{className:"font-semibold text-yellow-800",children:"⚠️ Chưa c\xf3 trong kho"}),(0,a.jsxs)("p",{className:"text-yellow-700",children:["Loại: ",e.blood_type_offered," (",R(s),")"]}),(0,a.jsx)("p",{className:"text-yellow-700 text-xs mt-1",children:"\uD83D\uDCA1 Hệ thống sẽ t\xecm kho c\xf3 sẵn c\xf9ng nh\xf3m m\xe1u hoặc tạo mới nếu cần"}),l&&(0,a.jsxs)("div",{className:"mt-1 p-2 bg-green-100 border border-green-300 rounded",children:[(0,a.jsxs)("p",{className:"text-green-800 font-semibold",children:["✨ Sẽ tạo mới: ",e.amount_offered,"ml"]}),(0,a.jsx)("p",{className:"text-green-700 text-xs",children:"Tạo inventory mới cho loại m\xe1u n\xe0y"})]})]})})(),(0,a.jsx)("p",{className:"font-medium text-gray-800 mt-2",children:"\uD83D\uDEE0 Cập nhật trạng th\xe1i:"}),(0,a.jsxs)(c.l6,{onValueChange:t=>X(s=>({...s,[e._id]:t})),value:Q[e._id]||"",children:[(0,a.jsx)(c.bq,{className:"w-full md:w-[300px] border-gray-300",children:(0,a.jsx)(c.yv,{placeholder:"Chọn trạng th\xe1i"})}),(0,a.jsx)(c.gC,{children:[{key:"in_progress",label:"Đang tiến h\xe0nh"},{key:"completed",label:"Ho\xe0n tất"},{key:"cancelled",label:"Đ\xe3 hủy"}].map(e=>(0,a.jsx)(c.eb,{value:e.key,children:e.label},e.key))})]}),(0,a.jsx)(r.$,{className:"mt-2 bg-blue-600 text-white hover:bg-blue-700",disabled:!Q[e._id]||Q[e._id]===e.status,onClick:()=>{el(Q[e._id],e._id)},children:"Cập nhật trạng th\xe1i"})]}),(0,a.jsx)("div",{className:"flex space-x-2"})]})]},e._id)}):"donor"===U?"":"blood-inventory"===U?"":(0,a.jsx)("p",{className:"text-gray-600",children:"Kh\xf4ng t\xecm thấy y\xeau cầu hiến m\xe1u từ người hiến."})]})})]})})]})]}),(0,a.jsx)(q.l$,{position:"top-center",containerStyle:{top:80}}),(0,a.jsx)(A.Footer,{})]})})}},8482:(e,t,s)=>{"use strict";s.d(t,{BT:()=>d,Wu:()=>c,ZB:()=>o,Zp:()=>r,aR:()=>i});var a=s(5155),n=s(2115),l=s(3999);let r=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...n})});r.displayName="Card";let i=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s),...n})});i.displayName="CardHeader";let o=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",s),...n})});o.displayName="CardTitle";let d=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...n})});d.displayName="CardDescription";let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",s),...n})});c.displayName="CardContent",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",s),...n})}).displayName="CardFooter"},8691:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(9946).A)("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[6237,3464,3568,461,1975,8441,1684,7358],()=>t(556)),_N_E=e.O()}]);