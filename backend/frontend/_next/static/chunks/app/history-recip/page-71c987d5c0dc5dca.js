(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[799],{1007:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},1243:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},3403:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=s(3464).A.create({baseURL:"/api"})},4186:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},6404:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>N});var r=s(5155),a=s(2115),l=s(8482),n=s(8145),i=s(7168),d=s(7949),c=s(7746),o=s(8074),m=s(7434),u=s(9397),h=s(8691),x=s(4186),p=s(4416),g=s(1007),f=s(9074),y=s(4516),j=s(1243),v=s(3403),b=s(395);function N(){let[e,t]=(0,a.useState)([]),[s,N]=(0,a.useState)({}),{user:w}=(0,b.A)();(0,a.useEffect)(()=>{(async()=>{if(null==w?void 0:w._id)try{var e;let s=await v.A.get("/recipient/blood-requests/".concat(w._id)),r=(null===(e=s.data)||void 0===e?void 0:e.requests)||[];if(Array.isArray(r)){t(r);let e=r.map(async e=>{try{var t,s;if(!e.hospital)return[e._id,"Kh\xf4ng x\xe1c định"];let r=await v.A.get("/hospital/".concat(e.hospital));return[e._id,(null===(s=r.data)||void 0===s?void 0:null===(t=s.hospital)||void 0===t?void 0:t.name)||"Kh\xf4ng x\xe1c định"]}catch(t){return console.error("Lỗi khi lấy t\xean bệnh viện:",t),[e._id,"Kh\xf4ng x\xe1c định"]}}),s=await Promise.all(e),a=Object.fromEntries(s);N(a)}else console.error("Data is not array:",r),t([])}catch(e){console.error("Lỗi khi lấy y\xeau cầu m\xe1u:",e),t([]),N({})}})()},[w]);let k=e=>{switch(e){case"completed":case"matched":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"cancelled":case"rejected":return"bg-red-100 text-red-800";case"in_progress":case"approved":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},A=async e=>{try{if(!window.confirm("Bạn c\xf3 chắc chắn muốn hủy y\xeau cầu n\xe0y?"))return;await v.A.put("/staff/blood-requests/".concat(e,"/status"),{status:"cancelled"}),t(t=>t.map(t=>t._id===e?{...t,status:"cancelled"}:t)),alert("Y\xeau cầu đ\xe3 được hủy th\xe0nh c\xf4ng!")}catch(e){var s,r,a;console.error("Lỗi khi hủy y\xeau cầu:",e),(null===(s=e.response)||void 0===s?void 0:s.status)===404?alert("Kh\xf4ng t\xecm thấy y\xeau cầu hoặc endpoint. Vui l\xf2ng li\xean hệ quản trị vi\xean."):(null===(r=e.response)||void 0===r?void 0:r.status)===403?alert("Bạn kh\xf4ng c\xf3 quyền hủy y\xeau cầu n\xe0y."):(null===(a=e.response)||void 0===a?void 0:a.status)===400?alert("Y\xeau cầu n\xe0y kh\xf4ng thể hủy được hoặc dữ liệu kh\xf4ng hợp lệ."):alert("C\xf3 lỗi xảy ra khi hủy y\xeau cầu. Vui l\xf2ng thử lại.")}},_=e=>"pending"===e||"approved"===e;return(0,r.jsx)(o.O,{requiredRole:"recipient",children:(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-rose-50 via-white to-red-50",children:[(0,r.jsx)(d.Header,{}),(0,r.jsx)("div",{className:"container mx-auto px-4 py-12",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,r.jsxs)("div",{className:"text-center mb-12",children:[(0,r.jsx)("div",{className:"flex justify-center mb-4",children:(0,r.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-red-500 to-rose-600 rounded-full flex items-center justify-center shadow-lg",children:(0,r.jsx)(m.A,{className:"w-8 h-8 text-white"})})}),(0,r.jsx)("h1",{className:"text-4xl font-bold text-black mb-3",children:"Lịch sử y\xeau cầu m\xe1u"}),(0,r.jsx)("p",{className:"text-gray-600 text-lg",children:"Theo d\xf5i v\xe0 quản l\xfd c\xe1c y\xeau cầu hiến m\xe1u của bạn"}),(0,r.jsx)("div",{className:"w-24 h-1 bg-gradient-to-r from-red-500 to-rose-500 mx-auto mt-4 rounded-full"})]}),e.length>0&&(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,r.jsx)(l.Zp,{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-blue-200 hover:shadow-lg transition-all duration-300",children:(0,r.jsx)(l.Wu,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-blue-600 text-sm font-medium",children:"Tổng y\xeau cầu"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-blue-800",children:e.length})]}),(0,r.jsx)(u.A,{className:"w-8 h-8 text-blue-600"})]})})}),(0,r.jsx)(l.Zp,{className:"bg-gradient-to-r from-green-50 to-green-100 border-green-200 hover:shadow-lg transition-all duration-300",children:(0,r.jsx)(l.Wu,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-green-600 text-sm font-medium",children:"Đ\xe3 gh\xe9p"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-green-800",children:e.filter(e=>"completed"===e.status||"matched"===e.status).length})]}),(0,r.jsx)(h.A,{className:"w-8 h-8 text-green-600"})]})})}),(0,r.jsx)(l.Zp,{className:"bg-gradient-to-r from-amber-50 to-amber-100 border-amber-200 hover:shadow-lg transition-all duration-300",children:(0,r.jsx)(l.Wu,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-amber-600 text-sm font-medium",children:"Chờ duyệt"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-amber-800",children:e.filter(e=>"pending"===e.status).length})]}),(0,r.jsx)(x.A,{className:"w-8 h-8 text-amber-600"})]})})}),(0,r.jsx)(l.Zp,{className:"bg-gradient-to-r from-red-50 to-red-100 border-red-200 hover:shadow-lg transition-all duration-300",children:(0,r.jsx)(l.Wu,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-red-600 text-sm font-medium",children:"Đ\xe3 hủy"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-red-800",children:e.filter(e=>"cancelled"===e.status).length})]}),(0,r.jsx)(p.A,{className:"w-8 h-8 text-red-600"})]})})})]}),e.length>0?(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:e.map((t,a)=>{var d,c,o;return(0,r.jsxs)(l.Zp,{className:"group hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 border-0 bg-white/80 backdrop-blur-sm relative overflow-hidden",style:{animationDelay:"".concat(100*a,"ms")},children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-red-500 to-rose-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-lg",style:{padding:"2px"},children:(0,r.jsx)("div",{className:"bg-white rounded-lg h-full w-full"})}),(0,r.jsx)(l.aR,{className:"relative z-10 pb-3",children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-red-500 to-rose-600 rounded-full flex items-center justify-center shadow-md group-hover:scale-110 transition-transform duration-300",children:(0,r.jsx)(g.A,{className:"w-6 h-6 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-bold text-gray-900",children:(null==t?void 0:null===(d=t.recipient_id)||void 0===d?void 0:d.fullName)||"Y\xeau cầu nhận m\xe1u #".concat(e.length-a)}),(0,r.jsx)("div",{className:"flex items-center space-x-2 mt-1",children:(0,r.jsx)(n.E,{variant:"outline",className:"text-red-600 border-red-300 bg-red-50 font-semibold",children:t.blood_type_needed})})]})]}),(0,r.jsxs)("div",{className:"flex flex-col items-end space-y-2",children:[_(t.status)&&(0,r.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>A(t._id),className:"h-8 px-3 py-1 text-red-500 border-red-200 hover:text-red-700 hover:bg-red-50 hover:border-red-300 rounded-md text-xs font-medium",title:"Hủy y\xeau cầu",children:"Hủy y\xeau cầu"}),(0,r.jsx)(n.E,{className:"".concat(k(t.status)," shadow-sm"),children:{pending:"Chờ duyệt",approved:"Đ\xe3 duyệt",matched:"Đ\xe3 gh\xe9p",in_progress:"Đang xử l\xfd",completed:"Đ\xe3 gh\xe9p",cancelled:"Đ\xe3 hủy",rejected:"Từ chối"}[c=t.status]||c})]})]})}),(0,r.jsx)(l.Wu,{className:"relative z-10 pt-0",children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center text-gray-700 group-hover:text-gray-900 transition-colors duration-300",children:[(0,r.jsx)(f.A,{className:"w-4 h-4 mr-3 text-blue-500"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:new Date(t.createdAt).toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric"})})]}),(0,r.jsxs)("div",{className:"flex items-center text-gray-700 group-hover:text-gray-900 transition-colors duration-300",children:[(0,r.jsx)(y.A,{className:"w-4 h-4 mr-3 text-green-500"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:s[t._id]||"Đang tải..."})]}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3 space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center text-gray-700",children:[(0,r.jsx)(h.A,{className:"w-4 h-4 mr-3 text-red-500"}),(0,r.jsxs)("span",{className:"text-sm",children:[(0,r.jsx)("strong",{children:"Th\xe0nh phần:"})," ",t.components_needed.map(e=>({Whole:"M\xe1u to\xe0n phần",RBC:"Hồng cầu",plasma:"Huyết tương",platelet:"Tiểu cầu",whole:"M\xe1u to\xe0n phần"})[e]||e).join(", ")]})]}),(0,r.jsxs)("div",{className:"flex items-center text-gray-700",children:[(0,r.jsx)("div",{className:"w-4 h-4 mr-3 flex items-center justify-center",children:(0,r.jsx)("div",{className:"w-2 h-2 bg-purple-500 rounded-full"})}),(0,r.jsxs)("span",{className:"text-sm",children:[(0,r.jsx)("strong",{children:"Mức độ:"})," ",(o=t.amount_needed)<=20?"Trẻ sơ sinh (10–20 ml/kg)":o<=350?"Hạ huyết \xe1p nhẹ (250–350 ml)":o<=700?"Thiếu m\xe1u vừa (350–700 ml)":o<=1400?"Thiếu m\xe1u nặng (700–1.400 ml)":o<=2e3?"Phẫu thuật lớn (700–2.000 ml)":"Mất m\xe1u cấp t\xednh (>1.400 ml)"]})]}),t.distance&&(0,r.jsxs)("div",{className:"flex items-center text-gray-700",children:[(0,r.jsx)("div",{className:"w-4 h-4 mr-3 flex items-center justify-center",children:(0,r.jsx)("div",{className:"w-2 h-2 bg-orange-500 rounded-full"})}),(0,r.jsxs)("span",{className:"text-sm",children:[(0,r.jsx)("strong",{children:"Khoảng c\xe1ch:"})," ",t.distance," km"]})]})]}),t.comment&&(0,r.jsx)("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-3 rounded-r-lg",children:(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("span",{className:"text-blue-600 mr-2",children:"\uD83D\uDCAC"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-blue-800 font-medium text-sm mb-1",children:"Ghi ch\xfa:"}),(0,r.jsx)("p",{className:"text-blue-700 text-sm whitespace-pre-line",children:t.comment})]})]})}),t.is_emergency&&(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsxs)(n.E,{className:"bg-gradient-to-r from-red-600 to-red-700 text-white px-4 py-2 rounded-full animate-pulse inline-flex items-center shadow-lg",children:[(0,r.jsx)(j.A,{className:"w-4 h-4 mr-2"}),"Y\xeau cầu khẩn cấp"]})})]})})]},t._id)})}):(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[400px] bg-white/50 rounded-2xl backdrop-blur-sm border border-gray-100",children:[(0,r.jsx)("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-6",children:(0,r.jsx)(m.A,{className:"w-12 h-12 text-gray-400"})}),(0,r.jsx)("h3",{className:"text-2xl font-bold text-gray-700 mb-2",children:"Chưa c\xf3 y\xeau cầu n\xe0o"}),(0,r.jsx)("p",{className:"text-gray-500 text-center max-w-md",children:"Bạn chưa thực hiện y\xeau cầu hiến m\xe1u n\xe0o. H\xe3y bắt đầu bằng c\xe1ch tạo y\xeau cầu mới."})]})]})}),(0,r.jsx)(c.Footer,{})]})})}},7388:(e,t,s)=>{Promise.resolve().then(s.bind(s,6404))},7434:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},8074:(e,t,s)=>{"use strict";s.d(t,{O:()=>c});var r=s(5155),a=s(2115),l=s(5695),n=s(9894),i=s(8482),d=s(1976);function c(e){let{children:t,requiredRole:s,redirectTo:c="/login"}=e,[o,m]=(0,a.useState)(null),[u,h]=(0,a.useState)(!0),x=(0,l.useRouter)();return((0,a.useEffect)(()=>{let e=(0,n.HW)();if(!e){x.push(c);return}if(s&&("user"===s&&"admin"===e.role||"user"!==s&&e.role!==s)){"admin"===e.role?x.push("/admin/dashboard"):"staff"===e.role?x.push("/staff/dashboard"):x.push("/user/dashboard");return}m(e),h(!1)},[x,s,c]),u)?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)(i.Zp,{className:"w-full max-w-md",children:(0,r.jsxs)(i.Wu,{className:"flex flex-col items-center justify-center p-8",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-red-500 rounded-full flex items-center justify-center mb-4 animate-pulse",children:(0,r.jsx)(d.A,{className:"w-8 h-8 text-white"})}),(0,r.jsx)("p",{className:"text-gray-600",children:"Đang kiểm tra quyền truy cập..."})]})})}):o?(0,r.jsx)(r.Fragment,{children:t}):null}},8145:(e,t,s)=>{"use strict";s.d(t,{E:()=>i});var r=s(5155);s(2115);var a=s(2085),l=s(3999);let n=(0,a.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:s,...a}=e;return(0,r.jsx)("div",{className:(0,l.cn)(n({variant:s}),t),...a})}},8482:(e,t,s)=>{"use strict";s.d(t,{BT:()=>c,Wu:()=>o,ZB:()=>d,Zp:()=>n,aR:()=>i});var r=s(5155),a=s(2115),l=s(3999);let n=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...a})});n.displayName="Card";let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s),...a})});i.displayName="CardHeader";let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",s),...a})});d.displayName="CardTitle";let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...a})});c.displayName="CardDescription";let o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",s),...a})});o.displayName="CardContent",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",s),...a})}).displayName="CardFooter"},8691:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]])},9074:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},9397:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[6237,6222,3464,1975,7949,8441,1684,7358],()=>t(7388)),_N_E=e.O()}]);