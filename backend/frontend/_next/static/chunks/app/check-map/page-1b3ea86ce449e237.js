(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6446],{3403:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});let n=r(3464).A.create({baseURL:"/api"})},4166:(e,t,r)=>{Promise.resolve().then(r.bind(r,6114))},6114:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var n=r(5155),a=r(8074),o=r(5695),s=r(7949),l=r(7746),i=r(2115),c=r(5411),d=r.n(c);r(8689);var u=r(3403);function p(){let e=(0,i.useRef)(null),t=(0,i.useRef)(null),[r,a]=(0,i.useState)(""),[o,s]=(0,i.useState)([]),[l,c]=(0,i.useState)(""),[p,h]=(0,i.useState)([]),[m,g]=(0,i.useState)([]),f=(0,i.useRef)([]),[x,b]=(0,i.useState)(-1),[y,v]=(0,i.useState)([]);(0,i.useEffect)(()=>{(async()=>{try{let e=await u.A.get("/hospital/");if(e.data.success){let t=e.data.hospitals.map(e=>({name:e.name,coords:[e.longitude,e.latitude],address:e.address,phone:e.phone}));v(t)}else console.error("Kh\xf4ng lấy được danh s\xe1ch bệnh viện:",e.data.message)}catch(e){console.error("Lỗi khi gọi API danh s\xe1ch bệnh viện:",e)}})()},[]);let w=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/đ/g,"d").replace(/Đ/g,"D"),j=(e,t,r)=>{if(!e||isNaN(t)||isNaN(r)){alert("T\xean bệnh viện v\xe0 tọa độ kh\xf4ng hợp lệ!");return}let n={name:e,coords:[t,r]};v(e=>[...e,n]),alert("✅ Đ\xe3 th\xeam: ".concat(e))},k=async()=>{if(!navigator.permissions)return alert("Tr\xecnh duyệt kh\xf4ng hỗ trợ Permissions API."),!1;try{let e=await navigator.permissions.query({name:"geolocation"});return"granted"===e.state}catch(e){return console.error("Lỗi kiểm tra quyền geolocation:",e),!1}},N=async e=>{let t=e.target.value;if(a(t),""===t.trim()){s([]);return}try{let e=await fetch("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(encodeURIComponent(t),".json?autocomplete=true&limit=5&country=VN&access_token=").concat(d().accessToken)),r=await e.json(),n=w(t.toLowerCase()),a=(r.features||[]).filter(e=>w(e.place_name.toLowerCase()).includes(n));s(a)}catch(e){console.error("Lỗi gợi \xfd địa điểm:",e),s([])}},T=(e,r,n)=>{m.forEach(e=>e.remove());let a=(e,t,r,n)=>{let a=Math.sin((r-e)*Math.PI/180/2)**2+Math.cos(e*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin((n-t)*Math.PI/180/2)**2;return 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))*6371},o=y.filter(t=>{let[o,s]=t.coords;return a(e,r,s,o)<=n});g(o.map(e=>new(d()).Marker({color:"orange"}).setLngLat(e.coords).setPopup(new(d()).Popup().setText("".concat(e.name))).addTo(t.current))),0===o.length&&alert("❗ Kh\xf4ng t\xecm thấy bệnh viện n\xe0o trong ".concat(n,"km."))},C=e=>{var r;c(e.name),h([]),null===(r=t.current)||void 0===r||r.flyTo({center:e.coords,zoom:15,essential:!0}),new(d()).Marker({color:"green"}).setLngLat(e.coords).setPopup(new(d()).Popup().setText(e.name)).addTo(t.current)},R=async e=>{if(!e.trim()){alert("Vui l\xf2ng nhập t\xean địa điểm gần bạn!");return}try{let r=await fetch("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(encodeURIComponent(e),".json?country=VN&access_token=").concat(d().accessToken)),n=await r.json();if(n.features&&n.features.length>0){let[r,a]=n.features[0].center;t.current.flyTo({center:[r,a],zoom:13,essential:!0}),new(d()).Marker({color:"purple"}).setLngLat([r,a]).setPopup(new(d()).Popup().setText("Vị tr\xed bạn chọn: ".concat(e))).addTo(t.current)}else alert('❗ Kh\xf4ng t\xecm thấy địa điểm "'.concat(e,'".'))}catch(e){console.error("Lỗi khi t\xecm địa điểm:",e),alert("Đ\xe3 xảy ra lỗi khi t\xecm địa điểm.")}};return(0,i.useEffect)(()=>{var r;(null===(r=navigator)||void 0===r?void 0:r.geolocation)&&navigator.geolocation.getCurrentPosition(r=>{let{longitude:n,latitude:a}=r.coords;console.log("\uD83D\uDCCD Tọa độ hiện tại:",a,n),t.current=new(d()).Map({container:e.current,style:"mapbox://styles/mapbox/streets-v12",center:[n,a],zoom:13}),new(d()).Marker({color:"blue"}).setLngLat([n,a]).setPopup(new(d()).Popup().setText("Bạn đang ở đ\xe2y")).addTo(t.current)},r=>{console.error(r),alert("Kh\xf4ng thể lấy vị tr\xed của bạn. Hiển thị bản đồ mặc định."),t.current=new(d()).Map({container:e.current,style:"mapbox://styles/mapbox/streets-v12",center:[106.700981,10.77653],zoom:12})})},[]),(0,i.useEffect)(()=>{if(x>=0&&x<p.length){var e;c(p[x].name),null===(e=f.current[x])||void 0===e||e.scrollIntoView({block:"nearest",behavior:"smooth"})}},[x,p]),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{style:{position:"absolute",zIndex:1,padding:10},children:[(0,n.jsx)("input",{type:"text",placeholder:"T\xecm bệnh viện...",value:l,onChange:e=>{let t=e.target.value;if(c(t),b(-1),""===t.trim()){h([]);return}let r=w(t.toLowerCase());h(y.filter(e=>w(e.name.toLowerCase()).includes(r)))},onKeyDown:e=>{0!==p.length&&("ArrowDown"===e.key?(e.preventDefault(),b(e=>(e+1)%p.length)):"ArrowUp"===e.key?(e.preventDefault(),b(e=>(e-1+p.length)%p.length)):"Enter"===e.key&&x>=0&&(e.preventDefault(),C(p[x])))},style:{padding:"8px",width:"300px",borderRadius:4,marginBottom:8}}),p.length>0&&(0,n.jsx)("ul",{style:{background:"#fff",border:"1px solid #ccc",marginTop:4,maxHeight:150,overflowY:"auto",listStyle:"none",padding:0,width:"300px"},children:p.map((e,t)=>(0,n.jsx)("li",{ref:e=>f.current[t]=e,onClick:()=>C(e),style:{padding:"8px",cursor:"pointer",borderBottom:"1px solid #eee",backgroundColor:t===x?"#f0f0f0":"#fff"},children:e.name},t))}),(0,n.jsxs)("div",{style:{marginTop:10},children:[(0,n.jsx)("button",{onClick:async()=>{alert(await k()?"✅ Đ\xe3 cho ph\xe9p định vị":"❌ Đ\xe3 từ chối định vị")},style:{padding:"8px 12px",borderRadius:4,background:"#007bff",color:"#fff",border:"none",cursor:"pointer",marginRight:8},children:"Kiểm tra quyền vị tr\xed"}),(0,n.jsx)("button",{onClick:()=>j("Bệnh viện ABC",106.81,10.88),style:{padding:"8px 12px",borderRadius:4,background:"#28a745",color:"#fff",border:"none",cursor:"pointer"},children:"Th\xeam BV ABC"})]}),(0,n.jsxs)("div",{style:{marginTop:10},children:[(0,n.jsx)("input",{type:"number",placeholder:"Khoảng c\xe1ch km...",id:"radiusInput",style:{padding:"8px",width:"140px",borderRadius:4,marginRight:8,border:"1px solid #ccc"}}),(0,n.jsx)("button",{onClick:()=>{let e=document.getElementById("radiusInput").value;if(!e||isNaN(e)||e<=0){alert("Nhập b\xe1n k\xednh hợp lệ (km)!");return}navigator.geolocation.getCurrentPosition(t=>{T(t.coords.latitude,t.coords.longitude,parseFloat(e))},e=>{console.error(e),alert("Kh\xf4ng thể lấy vị tr\xed của bạn.")})},style:{padding:"8px 12px",borderRadius:4,background:"#17a2b8",color:"#fff",border:"none",cursor:"pointer"},children:"T\xecm bệnh viện gần"})]}),(0,n.jsxs)("div",{style:{marginTop:10},children:[(0,n.jsx)("input",{type:"text",placeholder:"Nhập địa điểm gần bạn...",value:r,onChange:N,style:{padding:"8px",width:"300px",borderRadius:4,marginRight:8,border:"1px solid #ccc"}}),(0,n.jsx)("button",{onClick:()=>R(r),style:{padding:"8px 12px",borderRadius:4,background:"#ffc107",color:"#000",border:"none",cursor:"pointer"},children:"X\xe1c định bằng địa điểm"}),o.length>0&&(0,n.jsx)("ul",{style:{background:"#fff",border:"1px solid #ccc",marginTop:4,maxHeight:150,overflowY:"auto",listStyle:"none",padding:0,width:"300px"},children:o.map((e,t)=>(0,n.jsx)("li",{onClick:()=>R(e.place_name),style:{padding:"8px",cursor:"pointer",borderBottom:"1px solid #eee"},children:e.place_name},t))})]})]}),(0,n.jsx)("div",{ref:e,style:{width:"100%",height:"100vh"}})]})}function h(){return(0,o.useSearchParams)().get("message"),(0,n.jsx)(a.O,{requiredRole:"user",children:(0,n.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-red-50 to-white flex flex-col",children:[(0,n.jsx)(s.Header,{}),(0,n.jsx)(p,{}),(0,n.jsx)(l.Footer,{})]})})}d().accessToken="pk.eyJ1IjoiZ2lhYmFvMTIzOTYzIiwiYSI6ImNtY2J1ejZ6ZTAxYjYybG9wOXJkYnRxMmkifQ.AL0ZjkYXmVV7UsTAPrgVxA"},8074:(e,t,r)=>{"use strict";r.d(t,{O:()=>c});var n=r(5155),a=r(2115),o=r(5695),s=r(9894),l=r(8482),i=r(1976);function c(e){let{children:t,requiredRole:r,redirectTo:c="/login"}=e,[d,u]=(0,a.useState)(null),[p,h]=(0,a.useState)(!0),m=(0,o.useRouter)();return((0,a.useEffect)(()=>{let e=(0,s.HW)();if(!e){m.push(c);return}if(r&&("user"===r&&"admin"===e.role||"user"!==r&&e.role!==r)){"admin"===e.role?m.push("/admin/dashboard"):"staff"===e.role?m.push("/staff/dashboard"):m.push("/user/dashboard");return}u(e),h(!1)},[m,r,c]),p)?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,n.jsx)(l.Zp,{className:"w-full max-w-md",children:(0,n.jsxs)(l.Wu,{className:"flex flex-col items-center justify-center p-8",children:[(0,n.jsx)("div",{className:"w-16 h-16 bg-red-500 rounded-full flex items-center justify-center mb-4 animate-pulse",children:(0,n.jsx)(i.A,{className:"w-8 h-8 text-white"})}),(0,n.jsx)("p",{className:"text-gray-600",children:"Đang kiểm tra quyền truy cập..."})]})})}):d?(0,n.jsx)(n.Fragment,{children:t}):null}},8482:(e,t,r)=>{"use strict";r.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>i,Zp:()=>s,aR:()=>l});var n=r(5155),a=r(2115),o=r(3999);let s=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a})});s.displayName="Card";let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",r),...a})});l.displayName="CardHeader";let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});i.displayName="CardTitle";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",r),...a})});c.displayName="CardDescription";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",r),...a})});d.displayName="CardContent",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",r),...a})}).displayName="CardFooter"},8689:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[168,240,6237,6222,3464,1975,7949,8441,1684,7358],()=>t(4166)),_N_E=e.O()}]);