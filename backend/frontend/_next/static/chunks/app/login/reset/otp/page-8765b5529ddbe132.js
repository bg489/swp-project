(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[302],{4766:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var s=r(5155),a=r(2115),l=r(7168),i=r(8482),n=r(9852),d=r(9026),c=r(5339),o=r(5695),u=r(6766),f=r(5784),m=r(3568);function x(){let[e,t]=(0,a.useState)(600),r=(0,o.useSearchParams)().get("email")||"",[x,g]=(0,a.useState)(Array(6).fill("")),h=(0,a.useRef)([]),[p,v]=(0,a.useState)(""),[b,y]=(0,a.useState)(!1),N=(0,o.useRouter)(),w=async()=>{try{var e;y(!0),v("");let s=await f.A.post("/otp/send",{email:r});m.Ay.success("Đ\xe3 gửi lại m\xe3 OTP mới!");let{expiresAt:a}=s.data||{},l=a?Math.floor((new Date(a).getTime()-Date.now())/1e3):600;t(l>0?l:600),g(Array(6).fill("")),null===(e=h.current[0])||void 0===e||e.focus()}catch(e){v("Kh\xf4ng thể gửi lại OTP. Vui l\xf2ng thử lại.")}finally{y(!1)}};(0,a.useEffect)(()=>{(async()=>{try{let{expiresAt:e}=(await f.A.get("/otp/status?email=".concat(r))).data,s=Math.floor((new Date(e).getTime()-Date.now())/1e3);t(s>0?s:0)}catch(e){console.error("Failed to fetch OTP expiration time:",e),t(0)}})()},[r]),(0,a.useEffect)(()=>{if(e<=0)return;let r=setInterval(()=>{t(e=>e-1)},1e3);return()=>clearInterval(r)},[e]);let j=(e,t)=>{if(!/^[0-9]?$/.test(e))return;let r=[...x];if(r[t]=e,g(r),e&&t<5){var s;null===(s=h.current[t+1])||void 0===s||s.focus()}},k=(e,t)=>{if("Backspace"===e.key&&!x[t]&&t>0){var r;null===(r=h.current[t-1])||void 0===r||r.focus()}},A=async e=>{e.preventDefault(),v(""),y(!0);let t=x.join("");if(6!==t.length){v("Vui l\xf2ng nhập đầy đủ 6 chữ số"),y(!1);return}try{if((await f.A.post("/otp/verify",{email:r,otp:t})).data.message){m.Ay.success("Nhập otp th\xe0nh c\xf4ng!");let e=await f.A.post("/users/reset/email",{email:r}),t=await e.data;t.message&&t.token?(console.log(t),N.push("/login/reset/new-password?token=".concat(t.token))):v(t.message||"Đăng nhập thất bại")}}catch(e){var s,a;v((null==e?void 0:null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.message)||"X\xe1c minh OTP thất bại.")}finally{y(!1)}};return(0,s.jsxs)(i.Zp,{className:"w-full max-w-md mx-auto shadow-lg",children:[(0,s.jsxs)(i.aR,{className:"text-center space-y-4",children:[(0,s.jsx)("div",{className:"w-16 h-16 rounded-full overflow-hidden mx-auto",children:(0,s.jsx)(u.default,{src:"/images/logo.webp",alt:"ScαrletBlood Logo",width:64,height:64,className:"w-full h-full object-cover"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(i.ZB,{className:"text-2xl font-bold",children:"X\xe1c minh OTP"}),(0,s.jsx)(i.BT,{className:"text-gray-600",children:"Nhập m\xe3 gồm 6 chữ số được gửi qua email"})]})]}),(0,s.jsx)(i.Wu,{children:(0,s.jsxs)("form",{onSubmit:A,className:"space-y-6",children:[p&&(0,s.jsxs)(d.Fc,{variant:"destructive",children:[(0,s.jsx)(c.A,{className:"h-4 w-4"}),(0,s.jsx)(d.TN,{children:p})]}),(0,s.jsx)("div",{className:"flex justify-center gap-2",children:x.map((t,r)=>(0,s.jsx)(n.p,{ref:e=>void(h.current[r]=e),type:"text",inputMode:"numeric",pattern:"[0-9]*",maxLength:1,className:"w-12 h-12 text-center text-lg border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500",value:t,onChange:e=>j(e.target.value,r),onKeyDown:e=>k(e,r),disabled:e<=0,required:!0},r))}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 text-center",children:["M\xe3 OTP sẽ hết hạn sau: ",(0,s.jsx)("span",{className:"font-semibold text-red-600",children:(e=>{let t=Math.floor(e/60);return"".concat(t.toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0"))})(e)})]}),(0,s.jsx)(l.$,{type:"button",onClick:w,disabled:b,className:"w-full border border-red-500 bg-white text-red-500 hover:bg-red-50",children:b?(0,s.jsxs)("div",{className:"flex items-center justify-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-red-500 mr-2"}),"Đang gửi lại..."]}):"Gửi lại OTP"}),(0,s.jsx)(l.$,{type:"submit",className:"w-full",disabled:b||e<=0,children:b?(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Đang x\xe1c minh..."]}):"X\xe1c minh"})]})}),(0,s.jsx)(m.l$,{position:"top-center",containerStyle:{top:80}})]})}var g=r(646),h=r(7949),p=r(7746);function v(){let e=(0,o.useSearchParams)().get("message");return(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-red-50 to-white flex flex-col",children:[(0,s.jsx)(h.Header,{}),(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center p-4 py-16",children:(0,s.jsxs)("div",{className:"w-full max-w-md",children:[e&&(0,s.jsxs)(d.Fc,{className:"mb-6 border-green-200 bg-green-50",children:[(0,s.jsx)(g.A,{className:"h-4 w-4 text-green-600"}),(0,s.jsx)(d.TN,{className:"text-green-800",children:decodeURIComponent(e)})]}),(0,s.jsx)(x,{})]})}),(0,s.jsx)(p.Footer,{})]})}},5339:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(9946).A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},5784:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=r(3464).A.create({baseURL:"/api"})},6348:(e,t,r)=>{Promise.resolve().then(r.bind(r,4766))},8482:(e,t,r)=>{"use strict";r.d(t,{BT:()=>c,Wu:()=>o,ZB:()=>d,Zp:()=>i,aR:()=>n});var s=r(5155),a=r(2115),l=r(3999);let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a})});i.displayName="Card";let n=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",r),...a})});n.displayName="CardHeader";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});d.displayName="CardTitle";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",r),...a})});c.displayName="CardDescription";let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",r),...a})});o.displayName="CardContent",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",r),...a})}).displayName="CardFooter"},9026:(e,t,r)=>{"use strict";r.d(t,{Fc:()=>d,TN:()=>c});var s=r(5155),a=r(2115),l=r(2085),i=r(3999);let n=(0,l.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),d=a.forwardRef((e,t)=>{let{className:r,variant:a,...l}=e;return(0,s.jsx)("div",{ref:t,role:"alert",className:(0,i.cn)(n({variant:a}),r),...l})});d.displayName="Alert",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("h5",{ref:t,className:(0,i.cn)("mb-1 font-medium leading-none tracking-tight",r),...a})}).displayName="AlertTitle";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,i.cn)("text-sm [&_p]:leading-relaxed",r),...a})});c.displayName="AlertDescription"},9852:(e,t,r)=>{"use strict";r.d(t,{p:()=>i});var s=r(5155),a=r(2115),l=r(3999);let i=a.forwardRef((e,t)=>{let{className:r,type:a,...i}=e;return(0,s.jsx)("input",{type:a,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...i})});i.displayName="Input"}},e=>{var t=t=>e(e.s=t);e.O(0,[912,837,233,568,975,949,441,684,358],()=>t(6348)),_N_E=e.O()}]);